{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 9ab5879cb0e2e6d8b6da","webpack:///external \"preact\"","webpack:///./server/connectors/wiki.js","webpack:///./components/PageTemplate.jsx","webpack:///external \"node-fetch\"","webpack:///./components/BookmarkList.jsx","webpack:///./server/connectors/bookmarks.js","webpack:///external \"cheerio\"","webpack:///external \"preact-render-to-string\"","webpack:///./components/AppShell.jsx","webpack:///./components/routes.js","webpack:///./components/Bookmark.jsx","webpack:///./components/BreadcrumbBar.jsx","webpack:///./components/DaysRemaining.jsx","webpack:///./components/ErrorPage.jsx","webpack:///./components/Footer.jsx","webpack:///./components/HomePage.jsx","webpack:///./components/NotFoundPage.jsx","webpack:///./components/SideNavigation.jsx","webpack:///./components/TopNavigation.jsx","webpack:///./components/TweetButton.jsx","webpack:///./components/TwitterIcon.jsx","webpack:///./components/WikiPage.jsx","webpack:///./server/pages/navigationPane.js","webpack:///./components/Components.jsx","webpack:///./components/SearchPage.jsx","webpack:///./components/SearchResultsList.jsx"],"names":["cheerio","require","fetch","BASE_URL","REST_URL","SEARCH_URL","HOME_PAGE_TITLE","LINKS_PLACEHOLDER","labelUrlRegex","RegExp","pageUrlRegex","viewpageUrlRegex","mapPageTitleToSiteUrl","escapePageTitle","title","replace","getTitleForPageWithId","pageId","query","then","response","json","labelToSiteUrl","label","pageTitleToSiteUrl","escaped","replacePlaceholderWithLinks","html","linksHtml","placeholder","rewriteElementAttribute","$element","attributeName","attributeValue","attr","labelUrlMatch","exec","rewritten","pageUrlMatch","viewpageUrlMatch","rewriteHtml","$","load","each","index","element","text","trim","isInternalNote","startsWith","endsWith","remove","search","searchText","escapedText","encodeURIComponent","console","log","results","unescapePageTitle","escapedPageTitle","wikiPageWithTitle","pageJson","Array","ancestors","wikiBody","body","view","value","module","exports","StandardPage","asyncProperties","SideNavigation","prototype","render","props","area","getArea","navigation","children","url","footer","length","BookmarkList","bookmarks","map","bookmarkProps","excludeTag","PRESTERITY_BOOKMARK_COLLECTION_ID","RAINDROP_REST_URL","MAX_BOOKMARKS_PER_PAGE","bookmarksForTopic","topic","getResultsForPage","resultPage0","items","bookmarkCount","count","pageCount","Math","ceil","getResultsForPages","additionalResultPages","forEach","resultPage","concat","sorted","sort","compareBookmarks","bookmark1","bookmark2","pageNumber","escapedTopic","mostRecentBookmarks","promises","page","Promise","all","AppShell","titleBar","analytics","baseUrl","__html","HomePage","Bookmark","domain","slice","date","parseLinkTitle","tags","filter","tag","wiki","comma","seeAlsoSection","seeLabel","excerpt","link","linkPartsRegex","match","BreadcrumbBar","breadcrumbs","ancestor","siteUrl","separator","DaysRemaining","today","Date","now","inaugurationDate","parse","utc1","UTC","getFullYear","getMonth","getDate","utc2","diffMilliseconds","MILLISECONDS_PER_DAY","diffDays","floor","message","days","ErrorPage","Footer","pagePromise","wikiPage","requestBookmarkCount","bookmarksPromise","Object","assign","apply","bookmarkList","bookmarkListHtml","NotFoundPage","navigationPane","TweetButton","encodedText","encodedUrl","href","fill","WikiPage","requestTitle","request","params","NAVIGATION_CACHE_DURATION","navigationTimestamp","cachedNavigationHtml","needsRefresh","getNavigationFromWiki","resolve","wikiResults","wikiPageJson","rewrittenHtml","li","$li","$a","navigationPaneHtml","SearchPage","q","isNewSearch","searchPromise","searchResults","searchHeader","SearchResultsList","links","result"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AChEA,mC;;;;;;ACAA;;;;;;;;AASA;AACA,MAAMA,UAAU,mBAAAC,CAAQ,CAAR,CAAhB;AACA,MAAMC,QAAQ,mBAAAD,CAAQ,CAAR,CAAd;;AAEA,MAAME,WAAW,kCAAjB;AACA,MAAMC,WAAY,GAAED,QAAS,wBAA7B;AACA,MAAME,aAAc,GAAED,QAAS,2BAA/B;;AAEA,MAAME,kBAAkB,MAAxB;AACA,MAAMC,oBAAqB,+CAA3B;;AAEA;AACA,MAAMC,gBAAgB,IAAIC,MAAJ,CAAY,GAAEN,QAAS,wBAAvB,CAAtB;;AAEA;AACA,MAAMO,eAAe,8BAArB;;AAEA;AACA;AACA,MAAMC,mBAAmB,+CAAzB;;AAGA;AACA,MAAMC,wBAAwB;AAC5B,WAAS,QADmB;AAE5B,4BAA0B,sCAFE;AAG5B,UAAQ,GAHoB;AAI5B,iBAAe,cAJa;AAK5B,kBAAgB,eALY;AAM5B,qBAAmB;AANS,CAA9B;;AAUA;;;AAGA,SAASC,eAAT,CAAyBC,KAAzB,EAAgC;AAC9B,SAAOA,MAAMC,OAAN,CAAc,IAAd,EAAoB,GAApB,CAAP;AACD;;AAED;;;AAGA,SAASC,qBAAT,CAA+BC,MAA/B,EAAuC;AACrC,QAAMC,QAAS,GAAEd,QAAS,IAAGa,MAAO,EAApC;AACA,SAAOf,MAAMgB,KAAN,EACNC,IADM,CACDC,YAAYA,SAASC,IAAT,EADX,EAENF,IAFM,CAEDE,QAAQ;AACZ,UAAMP,QAAQD,gBAAgBQ,KAAKP,KAArB,CAAd;AACA,WAAOA,KAAP;AACD,GALM,CAAP;AAMD;;AAED;;;AAGA,SAASQ,cAAT,CAAwBC,KAAxB,EAA+B;AAC7B;AACA,SAAQ,oBAAmBA,KAAM,EAAjC;AACD;;AAED;;;AAGA,SAASC,kBAAT,CAA4BV,KAA5B,EAAmC;AACjC;AACA;AACA,QAAMW,UAAUZ,gBAAgBC,KAAhB,CAAhB;AACA,SAAOF,sBAAsBa,OAAtB,KAAmC,cAAaA,OAAQ,EAA/D;AACD;;AAED,SAASC,2BAAT,CAAqCC,IAArC,EAA2CC,SAA3C,EAAsD;AACpD,QAAMC,cAAe,OAAMtB,iBAAkB,OAA7C;AACA,SAAOoB,KAAKZ,OAAL,CAAac,WAAb,EAA0BD,SAA1B,CAAP;AACD;;AAED;;;AAGA,SAASE,uBAAT,CAAiCC,QAAjC,EAA2CC,aAA3C,EAA0D;;AAExD,QAAMC,iBAAiBF,SAASG,IAAT,CAAcF,aAAd,CAAvB;;AAEA,QAAMG,gBAAgB3B,cAAc4B,IAAd,CAAmBH,cAAnB,CAAtB;AACA,MAAIE,aAAJ,EAAmB;AACjB,UAAMZ,QAAQY,cAAc,CAAd,CAAd;AACA,UAAME,YAAYf,eAAeC,KAAf,CAAlB;AACAQ,aAASG,IAAT,CAAcF,aAAd,EAA6BK,SAA7B;AACA,WAJiB,CAIT;AACT;;AAED,QAAMC,eAAe5B,aAAa0B,IAAb,CAAkBH,cAAlB,CAArB;AACA,MAAIK,YAAJ,EAAkB;AAChB,UAAMxB,QAAQwB,aAAa,CAAb,CAAd;AACA,UAAMD,YAAYb,mBAAmBV,KAAnB,CAAlB;AACAiB,aAASG,IAAT,CAAcF,aAAd,EAA6BK,SAA7B;AACA;AACD;;AAED,QAAME,mBAAmB5B,iBAAiByB,IAAjB,CAAsBH,cAAtB,CAAzB;AACA,MAAIM,gBAAJ,EAAsB;AACpB,UAAMtB,SAASsB,iBAAiB,CAAjB,CAAf;AACA,UAAMF,YAAa,iBAAgBpB,MAAO,EAA1C;AACAc,aAASG,IAAT,CAAcF,aAAd,EAA6BK,SAA7B;AACD;AACF;;AAED;AACA,SAASG,WAAT,CAAqBb,IAArB,EAA2B;AACzB,QAAMc,IAAIzC,QAAQ0C,IAAR,CAAaf,IAAb,CAAV,CADyB,CACK;;AAE9B;AACAc,IAAE,SAAF,EAAaE,IAAb,CAAkB,CAACC,KAAD,EAAQC,OAAR,KAAoB;AACpCf,4BAAwBW,EAAEI,OAAF,CAAxB,EAAoC,MAApC;AACD,GAFD;;AAIA;AACA;AACA;AACAJ,IAAE,IAAF,EAAQE,IAAR,CAAa,CAACC,KAAD,EAAQC,OAAR,KAAoB;AAC/B,UAAMd,WAAWU,EAAEI,OAAF,CAAjB;AACA,UAAMC,OAAOf,SAASe,IAAT,GAAgBC,IAAhB,EAAb;AACA,QAAID,SAASvC,iBAAb,EAAgC;AAC9B;AACA;AACD;AACD,UAAMyC,iBAAiBF,KAAKG,UAAL,CAAgB,GAAhB,KAAwBH,KAAKI,QAAL,CAAc,GAAd,CAA/C;AACA,QAAIF,cAAJ,EAAoB;AAClBjB,eAASoB,MAAT;AACD;AACF,GAXD;;AAaA,SAAOV,EAAEd,IAAF,EAAP,CAxByB,CAwBR;AAClB;;AAED;AACA;AACA;AACA;AACA,SAASyB,MAAT,CAAgBC,UAAhB,EAA4B;AAC1B,QAAMC,cAAcC,mBAAmBF,UAAnB,CAApB;AACA,QAAMnC,QAAS,GAAEb,UAAW,SAAQiD,WAAY,GAAhD;AACAE,UAAQC,GAAR,CAAa,eAAcvC,KAAM,EAAjC;AACA,SAAOhB,MAAMgB,KAAN,EACNC,IADM,CACDC,YAAYA,SAASC,IAAT,EADX,EAENF,IAFM,CAEDE,QAAQA,KAAKqC,OAFZ,CAAP;AAGD;;AAED,SAASC,iBAAT,CAA2BC,gBAA3B,EAA6C;AAC3C,SAAOA,iBAAiB7C,OAAjB,CAAyB,KAAzB,EAAgC,GAAhC,CAAP;AACD;;AAED;AACA;AACA;AACA,SAAS8C,iBAAT,CAA2B/C,KAA3B,EAAkC;AAChC,QAAMI,QAAS,GAAEd,QAAS,sBAAqBU,KAAM,mCAArD;AACA0C,UAAQC,GAAR,CAAa,SAAQvC,KAAM,EAA3B;AACA,SAAOhB,MAAMgB,KAAN,EACNC,IADM,CACDC,YAAYA,SAASC,IAAT,EADX,EAENF,IAFM,CAEDE,QAAQ;;AAEZ;AACA;AACA,UAAMyC,WAAWzC,KAAKqC,OAAL,YAAwBK,KAAxB,GACf1C,KAAKqC,OAAL,CAAa,CAAb,CADe,GAEfrC,IAFF;;AAIA,QAAI,CAACyC,QAAL,EAAe;AACb,aAAO,IAAP;AACD;;AAED,UAAME,YAAYF,SAASE,SAA3B;AACA,UAAMlD,QAAQgD,SAAShD,KAAvB;AACA,UAAMmD,WAAWH,SAASI,IAAT,CAAcC,IAAd,CAAmBC,KAApC;;AAEA;AACA;AACA,UAAMF,OAAO1B,YAAYyB,QAAZ,CAAb;;AAEA,WAAO,EAAED,SAAF,EAAaE,IAAb,EAAmBpD,KAAnB,EAAP;AACD,GAvBM,CAAP;AAwBD;;AAGDuD,OAAOC,OAAP,GAAiB;AACfnE,UADe;AAEfU,iBAFe;AAGfG,uBAHe;AAIfV,iBAJe;AAKfgB,gBALe;AAMfE,oBANe;AAOfE,6BAPe;AAQftB,UARe;AASfoC,aATe;AAUfY,QAVe;AAWfO,mBAXe;AAYfE;AAZe,CAAjB,C;;;;;;;;;;;;;CClMuC;AACvC;AACA;AACA;AACA;;AAGA;;;AAGe,MAAMU,YAAN,SAA2B,iDAA3B,CAAqC;;AAElD,MAAIC,eAAJ,GAAsB;AACpB,WAAO,gEAAAC,CAAeC,SAAf,CAAyBF,eAAhC,CADoB,CAC6B;AAClD;;AAEDG,SAAOC,KAAP,EAAc;AACZ,UAAMC,OAAOC,QAAQF,KAAR,CAAb;;AAEA,WACE;AAAA;AAAA,QAAK,SAAM,aAAX,EAAyB,MAAMC,IAA/B;AACE,uEAAC,gEAAD,IAAgB,YAAYD,MAAMG,UAAlC,GADF;AAEE;AAAA;AAAA,UAAK,SAAM,MAAX;AACE,yEAAC,+DAAD,OADF;AAEE;AAAA;AAAA,YAAK,SAAM,eAAX;AACE,oFAAK,SAAM,QAAX,GADF;AAEE,2EAAC,+DAAD,IAAe,WAAWH,MAAMZ,SAAhC,GAFF;AAGE,oFAAK,SAAM,QAAX;AAHF,SAFF;AAOE;AAAA;AAAA,YAAK,SAAM,kBAAX;AACE,oFAAK,SAAM,QAAX,GADF;AAEE;AAAA;AAAA,cAAS,SAAM,aAAf;AACE,sFAAK,IAAG,gBAAR,EAAyB,KAAI,qBAA7B,EAAmD,KAAI,qCAAvD,GADF;AAEE;AAAA;AAAA,gBAAI,SAAM,WAAV;AAAuBY,oBAAM9D;AAA7B,aAFF;AAGE;AAAA;AAAA;AACG8D,oBAAMI;AADT,aAHF;AAME;AAAC,sEAAD;AAAA,gBAAQ,OAAOJ,MAAM9D,KAArB,EAA4B,KAAK8D,MAAMK,GAAvC;AAA6CL,oBAAMM;AAAnD;AANF,WAFF;AAUE,oFAAK,SAAM,QAAX;AAVF;AAPF;AAFF,KADF;AAyBD;;AAlCiD;AAAA;AAAA;;AAuCpD;AACA,SAASJ,OAAT,CAAiBF,KAAjB,EAAwB;AACtB,QAAMZ,YAAYY,MAAMZ,SAAxB;AACA,MAAI,CAACA,SAAL,EAAgB;AACd;AACA,WAAO,EAAP;AACD,GAHD,MAGO,IAAIA,UAAUmB,MAAV,KAAqB,CAArB,IAA0BP,MAAM9D,KAAN,KAAgB,YAA9C,EAA4D;AACjE;AACA,WAAO,MAAP;AACD,GAHM,MAGA,IAAIkD,UAAUmB,MAAV,KAAqB,CAAzB,EAA4B;AACjC;AACA,WAAOP,MAAM9D,KAAb;AACD,GAHM,MAGA,IAAIkD,UAAU,CAAV,EAAalD,KAAb,KAAuB,MAA3B,EAAmC;AACxC;AACA,WAAO,WAAP;AACD,GAHM,MAGA,IAAIkD,UAAUmB,MAAV,GAAmB,CAAvB,EAA0B;AAC/B;AACA,WAAOnB,UAAU,CAAV,EAAalD,KAApB;AACD,GAHM,MAGA;AACL;AACA,WAAO,EAAP;AACD;AACF,C;;;;;;ACvED,uC;;;;;;;;;;;;CCAuC;AACvC;;AAGA;;;AAGe,MAAMsE,YAAN,SAA2B,iDAA3B,CAAqC;;AAElDT,SAAOC,KAAP,EAAc;AACZ,UAAMS,YAAYT,MAAMS,SAAN,CAAgBC,GAAhB,CAAoBC,iBACpC,iEAAC,0DAAD,eAAcA,aAAd,IAA6B,YAAYX,MAAMY,UAA/C,IADgB,CAAlB;AAGA,WACE;AAAA;AAAA,QAAO,SAAM,YAAb;AAA2BH;AAA3B,KADF;AAGD;;AATiD,C;;;;;;;;ACPpD;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA,MAAMnF,QAAQ,mBAAAD,CAAQ,CAAR,CAAd;;AAEA,MAAMwF,oCAAoC,OAA1C;AACA,MAAMC,oBAAqB,qCAAoCD,iCAAkC,EAAjG;AACA,MAAME,yBAAyB,EAA/B,C,CAAmC;;;AAGnC;;;;;;;;AAQA,SAASC,iBAAT,CAA2BC,KAA3B,EAAkC;;AAEhC,MAAIR,SAAJ;;AAEA;AACA,SAAOS,kBAAkBD,KAAlB,EAAyB,CAAzB,EACN1E,IADM,CACD4E,eAAe;;AAEnB;AACAV,gBAAYU,YAAYC,KAAxB;;AAEA;AACA;AACA,UAAMC,gBAAgBF,YAAYG,KAAlC;AACA,UAAMC,YAAYC,KAAKC,IAAL,CAAUJ,gBAAgBN,sBAA1B,CAAlB;;AAEA;AACA,WAAOW,mBAAmBT,KAAnB,EAA0BM,SAA1B,CAAP;AACD,GAbM,EAcNhF,IAdM,CAcDoF,yBAAyB;;AAE7B;AACAA,0BAAsBC,OAAtB,CAA8BC,cAAc;AAC1CpB,kBAAYA,UAAUqB,MAAV,CAAiBD,WAAWT,KAA5B,CAAZ;AACD,KAFD;;AAIA;AACA,UAAMW,SAAStB,UAAUuB,IAAV,CAAeC,gBAAf,CAAf;;AAEA,WAAOF,MAAP;AACD,GAzBM,CAAP;AA0BD;;AAED;AACA;AACA;AACA,SAASE,gBAAT,CAA0BC,SAA1B,EAAqCC,SAArC,EAAgD;AAC9C,MAAID,UAAUhG,KAAV,GAAkBiG,UAAUjG,KAAhC,EAAuC;AACrC,WAAO,CAAC,CAAR;AACD;AACD,MAAIgG,UAAUhG,KAAV,GAAkBiG,UAAUjG,KAAhC,EAAuC;AACrC,WAAO,CAAP;AACD;AACD,SAAO,CAAP;AACD;;AAED;AACA,SAASgF,iBAAT,CAA2BD,KAA3B,EAAkCmB,UAAlC,EAA8C;AAC5C,QAAMC,eAAe1D,mBAAmBsC,KAAnB,CAArB;AACA,QAAMZ,MAAO,GAAES,iBAAkB,gCAA+BuB,YAAa,eAActB,sBAAuB,SAAQqB,UAAW,EAArI;AACAxD,UAAQC,GAAR,CAAa,cAAawB,GAAI,EAA9B;AACA,SAAO/E,MAAM+E,GAAN,EACN9D,IADM,CACDC,YAAYA,SAASC,IAAT,EADX,CAAP;AAED;;AAED;AACA;AACA,SAAS6F,mBAAT,CAA6BhB,QAAQ,EAArC,EAAyC;AACvC,QAAMjB,MAAO,GAAES,iBAAkB,YAAWQ,KAAM,EAAlD;AACA1C,UAAQC,GAAR,CAAa,qBAAoBwB,GAAI,EAArC;AACA,SAAO/E,MAAM+E,GAAN,EACN9D,IADM,CACDC,YAAYA,SAASC,IAAT,EADX,EAENF,IAFM,CAEDE,QAAQA,KAAK2E,KAFZ,CAAP;AAGD;;AAED;AACA;AACA;AACA;AACA,SAASM,kBAAT,CAA4BT,KAA5B,EAAmCM,SAAnC,EAA8C;AAC5C,MAAIgB,WAAW,EAAf;AACA,OAAK,IAAIC,OAAO,CAAhB,EAAmBA,OAAOjB,SAA1B,EAAqCiB,MAArC,EAA6C;AAC3CD,eAAWA,SAAST,MAAT,CAAgBZ,kBAAkBD,KAAlB,EAAyBuB,IAAzB,CAAhB,CAAX;AACD;AACD,SAAOC,QAAQC,GAAR,CAAYH,QAAZ,CAAP;AACD;;AAED9C,OAAOC,OAAP,GAAiB;AACfsB,mBADe;AAEfsB;AAFe,CAAjB,C;;;;;;ACzHA,oC;;;;;;ACAA,oD;;;;;;;;;CCAuC;;;AAGxB,MAAMK,QAAN,SAAuB,iDAAvB,CAAiC;;AAE9C5C,SAAOC,KAAP,EAAc;;AAEZ,UAAM4C,WACJ5C,MAAM4C,QAAN,IACC5C,MAAM9D,KAAN,IAAgB,GAAE8D,MAAM9D,KAAM,eAD/B,IAEA,EAHF;;AAKA;AACA;AACA,UAAM2G,YAAa;;;;KAAnB;;AAMA,WACE;AAAA;AAAA,QAAM,MAAK,IAAX;AACE;AAAA;AAAA;AACE,mFAAM,SAAQ,OAAd,GADF;AAEE,mFAAM,MAAK,UAAX,EAAsB,SAAQ,sCAA9B,GAFF;AAGE;AAAA;AAAA;AAAQD;AAAR,SAHF;AAIE,mFAAM,KAAI,YAAV,EAAuB,MAAK,kBAA5B,GAJF;AAKE,mFAAM,KAAI,eAAV,EAA0B,MAAK,qBAA/B,EAAqD,MAAK,cAA1D,GALF;AAME,mFAAM,KAAI,kBAAV,EAA6B,OAAM,SAAnC,EAA6C,MAAK,qBAAlD,GANF;AAOE,mFAAM,KAAI,UAAV,EAAqB,MAAK,uBAA1B,GAPF;AAQE,mFAAM,MAAK,0BAAX,EAAsC,SAAQ,6CAA9C,GARF;AASE,mFAAM,UAAS,UAAf,EAA0B,SAAS5C,MAAM9D,KAAzC,GATF;AAUE,mFAAM,UAAS,QAAf,EAAwB,SAAS8D,MAAMK,GAAvC,GAVF;AAWE,mFAAM,UAAS,UAAf,EAA0B,SAAU,GAAEL,MAAM8C,OAAQ,2BAApD,GAXF;AAYE,qFAAQ,yBAAyB,EAAEC,QAAQF,SAAV,EAAjC,GAZF;AAaE,qFAAQ,WAAR,EAAc,KAAI,+CAAlB;AAbF,OADF;AAgBE;AAAA;AAAA,UAAM,MAAM7C,MAAMC,IAAlB;AACE;AAAA;AAAA,YAAK,IAAG,MAAR;AACGD,gBAAMI;AADT;AADF;AAhBF,KADF;AAwBD;;AAzC6C,C;;;;;;;;;;;;;;ACHhD;AACA;AACA;AACA;AACA;;AAGA;;;AAGA,wDAAe;AACb,YAAU,2DADG;AAEb,eAAa,8DAFA,EAEc;AAC3B,aAAW,4DAHE;AAIb,aAAW,0DAJE;AAKb,mBAAiB,0DALJ;AAMb,OAAK,0DAAA4C;AANQ,CAAf,C;;;;;;;;;;;CCVuC;AACvC;;AAGA;;;;;;;;;AASe,MAAMC,QAAN,SAAuB,iDAAvB,CAAiC;;AAE9ClD,SAAOC,KAAP,EAAc;;AAEZ,QAAIkD,SAASlD,MAAMkD,MAAnB;AACA,QAAIA,OAAO7E,UAAP,CAAkB,MAAlB,CAAJ,EAA+B;AAC7B6E,eAASA,OAAOC,KAAP,CAAa,CAAb,CAAT,CAD6B,CACH;AAC3B;;AAED;AACA;AACA,UAAM,EAAEC,IAAF,EAAQlF,IAAR,KAAiBmF,eAAerD,MAAM9D,KAArB,CAAvB;;AAEA;AACA;AACA,UAAMoH,OAAOtD,MAAMsD,IAAN,CACVC,MADU,CACHC,OAAOA,QAAQxD,MAAMY,UADlB,EAEVF,GAFU,CAEN,CAAC8C,GAAD,EAAMxF,KAAN,KAAgB;AACnB,YAAMqC,MAAO,cAAa,+DAAAoD,CAAKxH,eAAL,CAAqBuH,GAArB,CAA0B,EAApD;AACA,YAAME,QAAQ1F,QAAQ,CAAR,GAAY,IAAZ,GAAmB,EAAjC;AACA,aACE;AAAA;AAAA;AACG0F,aADH;AAEE;AAAA;AAAA,YAAG,MAAMrD,GAAT;AAAemD;AAAf;AAFF,OADF;AAMD,KAXU,CAAb;;AAaA,QAAIG,iBAAiB,IAArB;AACA,QAAIL,KAAK/C,MAAL,GAAc,CAAlB,EAAqB;AACnB,YAAMqD,WAAW5D,MAAMY,UAAN,GAAmB,UAAnB,GAAgC,KAAjD;AACA+C,uBACE;AAAA;AAAA;AAAA;AAAQC,gBAAR;AAAA;AAAmBN,YAAnB;AAAA;AAAA,OADF;AAGD;;AAED;AACA,UAAMO,UAAU7D,MAAM6D,OAAN,GAEZ;AAAA;AAAA;AACE;AAAA;AAAA,UAAK,SAAM,SAAX;AAAsB7D,cAAM6D;AAA5B;AADF,KAFY,GAMd,IANF;;AAQA,WACE;AAAA;AAAA;AACE;AAAA;AAAA;AAAKT;AAAL,OADF;AAEE;AAAA;AAAA;AACGlF,YADH;AAAA;AAEE;AAAA;AAAA,YAAG,MAAM8B,MAAM8D,IAAf;AAAsBZ;AAAtB,SAFF;AAAA;AAGGS,sBAHH;AAIGE;AAJH;AAFF,KADF;AAWD;;AAxD6C;AAAA;AAAA;;AA6DhD,SAASR,cAAT,CAAwBnH,KAAxB,EAA+B;AAC7B;AACA;AACA;AACA;AACA;AACA,QAAM6H,iBAAiB,uBAAvB;AACA,QAAMC,QAAQD,eAAevG,IAAf,CAAoBtB,KAApB,CAAd;AACA,MAAIkH,IAAJ;AACA,MAAIlF,IAAJ;AACA,MAAI8F,KAAJ,EAAW;AACTZ,WAAOY,MAAM,CAAN,CAAP;AACA9F,WAAO8F,MAAM,CAAN,CAAP;AACD,GAHD,MAGO;AACLZ,WAAO,EAAP;AACAlF,WAAOhC,KAAP;AACD;AACD,SAAO,EAAEkH,IAAF,EAAQlF,IAAR,EAAP;AACD,C;;;;;;;;;CC5FsC;AACvC,MAAMuF,OAAO,mBAAApI,CAAQ,CAAR,CAAb;;AAGA;;;AAGe,MAAM4I,aAAN,SAA4B,iDAA5B,CAAsC;;AAEnDlE,SAAOC,KAAP,EAAc;;AAEZ;AACA,UAAMZ,YAAYY,MAAMZ,SAAN,IAAmB,CAAC,EAAElD,OAAO,MAAT,EAAD,CAArC;;AAEA,UAAMgI,cAAc9E,UAAUsB,GAAV,CAAc,CAACyD,QAAD,EAAWnG,KAAX,KAAqB;AACrD,YAAM9B,QAAQiI,SAASjI,KAAvB;AACA,YAAMkI,UAAUX,KAAK7G,kBAAL,CAAwBV,KAAxB,CAAhB;AACA,YAAMmI,YAAYrG,QAAQ,CAAR,GAAY,KAAZ,GAAoB,EAAtC;AACA,aACE;AAAA;AAAA;AACGqG,iBADH;AAEE;AAAA;AAAA,YAAG,MAAMD,OAAT;AAAmBlI;AAAnB;AAFF,OADF;AAMD,KAVmB,CAApB;;AAYA,WACE;AAAA;AAAA,QAAK,SAAM,aAAX;AAA0BgI;AAA1B,KADF;AAGD;;AAtBkD,C;;;;;;;;;;;CCPd;;;AAGvC;;;AAGe,MAAMI,aAAN,SAA4B,iDAA5B,CAAsC;;AAEnDvE,SAAOC,KAAP,EAAc;;AAEZ,UAAMuE,QAAQ,IAAIC,IAAJ,CAASA,KAAKC,GAAL,EAAT,CAAd;AACA,UAAMC,mBAAmB,IAAIF,IAAJ,CAASA,KAAKG,KAAL,CAAW,+BAAX,CAAT,CAAzB;;AAEA;AACA;AACA,UAAMC,OAAOJ,KAAKK,GAAL,CAASN,MAAMO,WAAN,EAAT,EAA8BP,MAAMQ,QAAN,EAA9B,EAAgDR,MAAMS,OAAN,EAAhD,CAAb;AACA,UAAMC,OAAOT,KAAKK,GAAL,CAASH,iBAAiBI,WAAjB,EAAT,EAAyCJ,iBAAiBK,QAAjB,EAAzC,EAAsEL,iBAAiBM,OAAjB,EAAtE,CAAb;AACA,UAAME,mBAAmBD,OAAOL,IAAhC;AACA,UAAMO,uBAAuB,KAAK,EAAL,GAAU,EAAV,GAAe,IAA5C;AACA,UAAMC,WAAW5D,KAAK6D,KAAL,CAAWH,mBAAmBC,oBAA9B,CAAjB;;AAEA,QAAIG,OAAJ;AACA,QAAIF,aAAa,CAAjB,EAAoB;AAClBE,gBACE;AAAA;AAAA;AAAA;AAAA,OADF;AAGD,KAJD,MAIO,IAAIF,WAAW,CAAf,EAAkB;AACvB,YAAMG,OAAOH,aAAa,CAAb,GAAiB,KAAjB,GAAyB,MAAtC;AACAE,gBACE;AAAA;AAAA;AAAA;AACiB;AAAA;AAAA;AAASF;AAAT,SADjB;AAAA;AAC8CG,YAD9C;AAAA;AAAA,OADF;AAMD,KARM,MAQA;AACL;AACAD,gBAAU,EAAV;AACD;;AAED,WACE;AAAA;AAAA,QAAG,IAAG,sBAAN;AACGA;AADH,KADF;AAKD;;AAtCkD,C;;;;;;;;;;;;CCNzB;AAC5B;;AAGA;;;AAGe,MAAME,SAAN,SAAwB,8DAAxB,CAAqC;;AAElDzF,SAAOC,KAAP,EAAc;AACZ,WACE;AAAC,oEAAD;AAAA;AACI,oBAAYA,MAAMG,UADtB;AAEI,eAAO,KAAKjE,KAFhB;AAGI,aAAK8D,MAAMK;AAHf;AAKE;AAAA;AAAA;AAAA;AAAA;AALF,KADF;AAWD;;AAED,MAAInE,KAAJ,GAAY;AACV,WAAO,MAAP;AACD;;AAlBiD,C;;;;;;;;;;;;;CCPb;AACvC;AACA;;AAEA;;;AAGe,MAAMuJ,MAAN,SAAqB,iDAArB,CAA+B;;AAE5C1F,SAAOC,KAAP,EAAc;AACZ,WACE;AAAA;AAAA;AACE;AAAA;AAAA;AACE,yEAAC,6DAAD,IAAa,MAAMA,MAAM9D,KAAzB,EAAgC,KAAK8D,MAAMK,GAA3C;AADF,OADF;AAIGL,YAAMI,QAJT;AAKE,uEAAC,+DAAD;AALF,KADF;AASD;;AAZ2C,C;;;;;;;;;;;;;;;;;;;CCPlB;AAC5B;AACA;AACA;AACA;AACA;;AAGA;;;;;;AAMe,MAAM4C,QAAN,SAAuB,8DAAvB,CAAoC;;AAEjD,MAAIpD,eAAJ,GAAsB;;AAEpB,UAAM1D,QAAQ,KAAKA,KAAnB;;AAEA;AACA,UAAMwJ,cAAc,+DAAAjC,CAAKxE,iBAAL,CAAuB/C,KAAvB,EACnBK,IADmB,CACdoJ,YAAY;AAChB,UAAI,CAACA,QAAL,EAAe;AACb;AACA,cAAO,qDAAoDzJ,KAAM,IAAjE;AACD;AACD,aAAO;AACLkD,mBAAWuG,SAASvG,SADf;AAELE,cAAMqG,SAASrG;AAFV,OAAP;AAID,KAVmB,CAApB;;AAYA;AACA,UAAMsG,uBAAuB,CAA7B;AACA,UAAMC,mBAAmB,oEAAApF,CAAU6B,mBAAV,CAA8BsD,oBAA9B,EACxBrJ,IADwB,CACnBkE,aAAa;AACjB,aAAO,EAAEA,SAAF,EAAP;AACD,KAHwB,CAAzB;;AAKA;AACA,WAAOgC,QAAQC,GAAR,CAAY,CAAC,MAAM9C,eAAP,EAAwB8F,WAAxB,EAAqCG,gBAArC,CAAZ,EACNtJ,IADM,CACDuC,WAAW;AACf,aAAOgH,OAAOC,MAAP,CAAcC,KAAd,CAAoB,EAApB,EAAwBlH,OAAxB,CAAP;AACD,KAHM,CAAP;AAID;;AAEDiB,SAAOC,KAAP,EAAc;;AAEZ;AACA;AACA,UAAMiG,eACJ,iEAAC,8DAAD,IAAc,WAAWjG,MAAMS,SAA/B,EAA0C,YAAY,KAAKvE,KAA3D,GADF;AAGA,UAAMgK,mBAAmB,+DAAAnG,CAAOkG,YAAP,CAAzB;AACA,UAAM3G,OAAO,+DAAAmE,CAAK3G,2BAAL,CAAiCkD,MAAMV,IAAvC,EAA6C4G,gBAA7C,CAAb;;AAEA,WACE;AAAC,oEAAD;AAAA;AACI,mBAAWlG,MAAMZ,SADrB;AAEI,oBAAYY,MAAMG,UAFtB;AAGI,eAAM,YAHV;AAII,aAAKH,MAAMK;AAJf;AAME,gFAAK,yBAAyB,EAAE0C,QAAQzD,IAAV,EAA9B;AANF,KADF;AAUD;;AAED,MAAIpD,KAAJ,GAAY;AACV,WAAO,MAAP;AACD;;AAED,MAAI0G,QAAJ,GAAe;AACb,WAAO,YAAP;AACD;;AA7DgD,C;;;;;;;;;;;;CCdvB;AAC5B;;AAGA;;;AAGe,MAAMuD,YAAN,SAA2B,8DAA3B,CAAwC;;AAErDpG,SAAOC,KAAP,EAAc;AACZ,WACE;AAAC,oEAAD;AAAA;AACI,mBAAWA,MAAMZ,SADrB;AAEI,gBAAQY,MAAMM,MAFlB;AAGI,oBAAYN,MAAMG,UAHtB;AAII,eAAO,KAAKjE,KAJhB;AAKI,aAAK8D,MAAMK;AALf;AAOE;AAAA;AAAA;AAAA;AACyC,aAAKnE,KAD9C;AAAA;AAAA,OAPF;AAUE;AAAA;AAAA;AAAA;AACqB;AAAA;AAAA,YAAG,MAAK,eAAR;AAAA;AAAA,SADrB;AAAA;AAAA;AAVF,KADF;AAiBD;;AAED,MAAIA,KAAJ,GAAY;AACV;AACA;AACA,WAAO,WAAP;AACD;;AA1BoD,C;;;;;;;;;;;CCPhB;AACvC,MAAMkK,iBAAiB,mBAAA/K,CAAQ,EAAR,CAAvB;;AAGA;;;AAGe,MAAMwE,cAAN,SAA6B,iDAA7B,CAAuC;;AAEpD,MAAID,eAAJ,GAAsB;AACpB,WAAOwG,iBACN7J,IADM,CACDQ,QAAQ;AACZ,aAAO;AACLoD,oBAAYpD;AADP,OAAP;AAGD,KALM,CAAP;AAMD;;AAEDgD,SAAOC,KAAP,EAAc;AACZ,WACE;AAAA;AAAA,QAAK,SAAM,gBAAX;AACE;AAAA;AAAA,UAAK,IAAG,WAAR;AACE;AAAA;AAAA,YAAG,IAAG,UAAN,EAAiB,MAAK,GAAtB;AACE,oFAAK,IAAG,MAAR,EAAe,KAAI,wBAAnB,EAA4C,KAAI,qCAAhD;AADF;AADF,OADF;AAME;AAAA;AAAA,UAAG,IAAG,wBAAN;AAAA;AACQ;AAAA;AAAA;AAAA;AAAA,SADR;AAAA;AAAA,OANF;AASE;AAAA;AAAA,UAAK,IAAG,2BAAR;AACE,kFAAK,IAAG,kBAAR;AADF,OATF;AAYE,gFAAK,SAAM,gBAAX,EAA4B,yBAAyB,EAAE+C,QAAQ/C,MAAMG,UAAhB,EAArD;AAZF,KADF;AAgBD;;AA5BmD,C;;;;;;;;;;;CCP1B;;;AAG5B;;;AAGA,wDAAgBH,KAAD,IACb;AAAA;AAAA,IAAQ,IAAG,eAAX;AACE,4EAAK,SAAM,QAAX,GADF;AAEE;AAAA;AAAA,MAAK,IAAG,UAAR;AACE;AAAA;AAAA,QAAG,IAAG,WAAN,EAAkB,MAAK,QAAvB;AAAA;AAAA,KADF;AAAA;AAEE;AAAA;AAAA,QAAG,IAAG,kBAAN,EAAyB,MAAK,eAA9B;AAAA;AAAA,KAFF;AAAA;AAGE;AAAA;AAAA,QAAG,IAAG,YAAN,EAAmB,MAAK,SAAxB;AAAA;AAAA,KAHF;AAAA;AAIE;AAAA;AAAA,QAAG,IAAG,iBAAN,EAAwB,MAAK,cAA7B;AAAA;AAAA;AAJF,GAFF;AAQE,4EAAK,SAAM,QAAX;AARF,CADF,C;;;;;;;;;;CCNuC;AACvC;;AAGe,MAAMqG,WAAN,SAA0B,iDAA1B,CAAoC;;AAEjDtG,SAAOC,KAAP,EAAc;AACZ,UAAMsG,cAAc3H,mBAAmBqB,MAAM9B,IAAzB,CAApB;AACA,UAAMqI,aAAa5H,mBAAmBqB,MAAMK,GAAzB,CAAnB;AACA,UAAMmG,OAAQ,wDAAuDF,WAAY,QAAOC,UAAW,EAAnG;AACA,WACE;AAAA;AAAA,QAAG,SAAM,aAAT,EAAuB,MAAMC,IAA7B;AACE,uEAAC,6DAAD,IAAa,MAAK,MAAlB,GADF;AAEE;AAAA;AAAA;AAAA;AAAA;AAFF,KADF;AAMD;;AAZgD,C;;;;;;;;;;;CCJvB;;;AAG5B;;;AAGA,wDAAgBxG,KAAD,IAAW;AACxB,QAAMyG,OAAOzG,MAAMyG,IAAN,IAAc,OAA3B;AACA,SACE;AAAA;AAAA,MAAK,SAAQ,yBAAb,EAAuC,OAAQ,SAAQA,IAAK,GAA5D;AACE;AAAA;AAAA,QAAG,OAAM,4BAAT,EAAsC,IAAG,KAAzC,EAA+C,WAAU,qCAAzD;AACE;AAAA;AAAA,UAAG,WAAU,WAAb;AACE,mFAAM,GAAE,6xBAAR;AADF;AADF;AADF,GADF;AASD,CAXD,C;;;;;;;;;;;;;;;;;CCN4B;AAC5B;AACA;AACA;AACA;AACA;;AAGA;;;AAGe,MAAMC,QAAN,SAAuB,8DAAvB,CAAoC;;AAEjD,MAAI9G,eAAJ,GAAsB;;AAEpB,UAAM1D,QAAQ,KAAKA,KAAnB;;AAEA;AACA,UAAMwJ,cAAc,+DAAAjC,CAAKxE,iBAAL,CAAuB/C,KAAvB,EACnBK,IADmB,CACdoJ,YAAY;AAChB,aAAO;AACLvG,mBAAWuG,SAASvG,SADf;AAELE,cAAMqG,SAASrG;AAFV,OAAP;AAID,KANmB,CAApB;;AAQA;AACA,UAAMuG,mBAAmB,oEAAApF,CAAUO,iBAAV,CAA4B9E,KAA5B,EACxBK,IADwB,CACnBkE,aAAa;AACjB,aAAO,EAAEA,SAAF,EAAP;AACD,KAHwB,CAAzB;;AAKA;AACA,WAAOgC,QAAQC,GAAR,CAAY,CAAC,MAAM9C,eAAP,EAAwB8F,WAAxB,EAAqCG,gBAArC,CAAZ,EACNtJ,IADM,CACDuC,WAAW;AACf,aAAOgH,OAAOC,MAAP,CAAcC,KAAd,CAAoB,EAApB,EAAwBlH,OAAxB,CAAP;AACD,KAHM,CAAP;AAID;;AAEDiB,SAAOC,KAAP,EAAc;;AAEZ;AACA;AACA,UAAMiG,eACJ,iEAAC,8DAAD,IAAc,WAAWjG,MAAMS,SAA/B,EAA0C,YAAY,KAAKvE,KAA3D,GADF;AAGA,UAAMgK,mBAAmB,+DAAAnG,CAAOkG,YAAP,CAAzB;AACA,UAAM3G,OAAO,+DAAAmE,CAAK3G,2BAAL,CAAiCkD,MAAMV,IAAvC,EAA6C4G,gBAA7C,CAAb;;AAEA,UAAM5F,SACJ;AAAA;AAAA;AACE;AAAA;AAAA;AAAA;AACU;AAAA;AAAA,YAAG,MAAK,cAAR;AAAA;AAAA,SADV;AAAA;AAGQ;AAAA;AAAA,YAAG,MAAK,eAAR;AAAA;AAAA,SAHR;AAAA;AAAA,OADF;AAME;AAAA;AAAA;AAAA;AAEI;AAAA;AAAA,YAAG,KAAI,SAAP,EAAiB,MAAK,8CAAtB;AAAA;AAAA,SAFJ;AAAA;AAAA;AANF,KADF;;AAcA,WACE;AAAC,oEAAD;AAAA;AACI,mBAAWN,MAAMZ,SADrB;AAEI,oBAAYY,MAAMG,UAFtB;AAGI,eAAO,KAAKjE,KAHhB;AAII,aAAK8D,MAAMK,GAJf;AAKI,gBAAQC;AALZ;AAOE,gFAAK,yBAAyB,EAAEyC,QAAQzD,IAAV,EAA9B;AAPF,KADF;AAWD;;AAED,MAAIpD,KAAJ,GAAY;AACV,UAAMyK,eAAe,KAAK3G,KAAL,CAAW4G,OAAX,CAAmBC,MAAnB,CAA0B3K,KAA/C;AACA,UAAMA,QAAQ,+DAAAuH,CAAK1E,iBAAL,CAAuB4H,YAAvB,CAAd;AACA,WAAOzK,KAAP;AACD;;AArEgD,C;;;;;;;;ACXnD,MAAMd,UAAU,mBAAAC,CAAQ,CAAR,CAAhB;AACA,MAAMC,QAAQ,mBAAAD,CAAQ,CAAR,CAAd;AACA,MAAMoI,OAAO,mBAAApI,CAAQ,CAAR,CAAb;;AAGA;AACA,MAAMyL,4BAA4B,IAAI,EAAJ,GAAS,IAA3C,C,CAAiD;;AAEjD;AACA,IAAIC,sBAAsB,CAA1B;;AAEA;AACA,IAAIC,oBAAJ;;AAGA;;;;;;;;;;;AAWAvH,OAAOC,OAAP,GAAiB,MAAM;AACrB,QAAMuH,eAAeD,wBAAwB,IAAxB,IAChBxC,KAAKC,GAAL,KAAasC,mBAAd,GAAqCD,yBADzC;AAEA,MAAIG,YAAJ,EAAkB;AAChB;AACA,WAAOC,wBACN3K,IADM,CACDQ,QAAQ;AACZiK,6BAAuBjK,IAAvB;AACA,aAAOA,IAAP;AACD,KAJM,CAAP;AAKD,GAPD,MAOO;AACL;AACA,WAAO0F,QAAQ0E,OAAR,CAAgBH,oBAAhB,CAAP;AACD;AACF,CAdD;;AAiBA;AACA,SAASE,qBAAT,GAAiC;AAC/B,QAAMhL,QAAQ,YAAd;AACA,QAAMI,QAAS,GAAEmH,KAAKjI,QAAS,sBAAqBU,KAAM,mBAA1D;AACA0C,UAAQC,GAAR,CAAa,eAAcvC,KAAM,EAAjC;AACA,SAAOhB,MAAMgB,KAAN,EACNC,IADM,CACDC,YAAYA,SAASC,IAAT,EADX,EAENF,IAFM,CAED6K,eAAe;AACnBL,0BAAsBvC,KAAKC,GAAL,EAAtB,CADmB,CACe;;AAElC,UAAM4C,eAAeD,YAAYtI,OAAZ,CAAoB,CAApB,CAArB;AACA,UAAMQ,OAAO+H,aAAa/H,IAAb,CAAkBC,IAAlB,CAAuBC,KAApC;;AAEA;AACA,UAAM8H,gBAAgB7D,KAAK7F,WAAL,CAAiB0B,IAAjB,CAAtB;;AAEA;AACA;AACA;AACA;AACA,UAAMzB,IAAIzC,QAAQ0C,IAAR,CAAawJ,aAAb,CAAV,CAbmB,CAaoB;AACvC;AACAzJ,MAAE,IAAF,EAAQE,IAAR,CAAa,CAACC,KAAD,EAAQuJ,EAAR,KAAe;AAC1B,YAAMC,MAAM3J,EAAE0J,EAAF,CAAZ,CAD0B,CACP;AACnB,YAAME,KAAK5J,EAAE2J,IAAIpH,QAAJ,CAAa,GAAb,EAAkB,CAAlB,CAAF,CAAX,CAF0B,CAEU;AACpC,UAAIqH,EAAJ,EAAQ;AACN;AACA,cAAMvJ,OAAOuJ,GAAGvJ,IAAH,EAAb;AACA;AACAsJ,YAAIlK,IAAJ,CAAS,iBAAT,EAA4BY,IAA5B;AACD;AACF,KATD;;AAWA,UAAMwJ,qBAAqB7J,EAAEd,IAAF,EAA3B;AACA,WAAO2K,kBAAP;AACD,GA9BM,CAAP;AA+BD,C;;;;;;;;;;;;AC/ED;AACA;;AAGA;;;;;;;;;;;;;;;;CCJ4B;AAC5B;AACA;AACA;;AAGA;;;AAGe,MAAMC,UAAN,SAAyB,8DAAzB,CAAsC;;AAEnD,MAAI/H,eAAJ,GAAsB;;AAEpB,UAAMnB,aAAa,KAAKuB,KAAL,CAAW4G,OAAX,CAAmBtK,KAAnB,CAAyBsL,CAA5C;;AAEA,UAAMC,cAAc,OAAOpJ,UAAP,KAAsB,WAA1C;AACA,UAAMqJ,gBAAgBD,cACpBpF,QAAQ0E,OAAR,EADoB,GACA;AACpB1D,IAAA,+DAAAA,CAAKjF,MAAL,CAAYC,UAAZ,EACGlC,IADH,CACQwL,iBAAiB;AACrB,aAAO;AACLjJ,iBAASiJ;AADJ,OAAP;AAGD,KALH,CAFF;;AASA,WAAOtF,QAAQC,GAAR,CAAY,CAAC,MAAM9C,eAAP,EAAwBkI,aAAxB,CAAZ,EACNvL,IADM,CACDuC,WAAW;AACf,aAAOgH,OAAOC,MAAP,CAAcC,KAAd,CAAoB,EAApB,EAAwBlH,OAAxB,CAAP;AACD,KAHM,CAAP;AAID;;AAEDiB,SAAOC,KAAP,EAAc;;AAEZ,UAAMvB,aAAauB,MAAM4G,OAAN,CAActK,KAAd,CAAoBsL,CAAvC;AACA,UAAMI,eAAe,CAAChI,MAAMlB,OAAP,GACnB,IADmB,GAEnBkB,MAAMlB,OAAN,CAAcyB,MAAd,GAAuB,CAAvB,GACG,qBAAoB9B,UAAW,GADlC,GAEG,gBAJL;;AAMA,WACE;AAAC,oEAAD;AAAA;AACI,mBAAWuB,MAAMZ,SADrB;AAEI,oBAAYY,MAAMG,UAFtB;AAGI,eAAO,KAAKjE,KAHhB;AAII,aAAK8D,MAAMK;AAJf;AAME;AAAA;AAAA;AAAA;AAEE,oFAAO,MAAK,GAAZ,EAAgB,MAAK,MAArB,EAA4B,OAAO5B,UAAnC,EAA+C,OAAM,iBAArD,GAFF;AAAA;AAGE,oFAAO,MAAK,QAAZ,EAAqB,OAAM,QAA3B;AAHF,OANF;AAWE;AAAA;AAAA;AAAKuJ;AAAL,OAXF;AAYE,uEAAC,mEAAD,IAAmB,SAAShI,MAAMlB,OAAlC;AAZF,KADF;AAgBD;;AAED,MAAI5C,KAAJ,GAAY;AACV,WAAO,QAAP;AACD;;AAnDkD,C;;;;;;;;;;;CCTd;AACvC,MAAMuH,OAAO,mBAAApI,CAAQ,CAAR,CAAb;;AAGA;;;;AAIe,MAAM4M,iBAAN,SAAgC,iDAAhC,CAA0C;;AAEvDlI,SAAOC,KAAP,EAAc;AACZ,UAAMkI,QAAQlI,MAAMlB,OAAN,IAAiBkB,MAAMlB,OAAN,CAAc4B,GAAd,CAAkByH,UAAU;AACzD,YAAMjM,QAAQiM,OAAOjM,KAArB;AACA,YAAMW,UAAU4G,KAAKxH,eAAL,CAAqBC,KAArB,CAAhB;AACA,YAAMsK,OAAQ,cAAa3J,OAAQ,EAAnC;AACA,aACE;AAAA;AAAA;AAAI;AAAA;AAAA,YAAG,MAAM2J,IAAT;AAAgBtK;AAAhB;AAAJ,OADF;AAGD,KAP8B,CAA/B;AAQA,WACE;AAAA;AAAA;AAAKgM;AAAL,KADF;AAGD;;AAdsD,C","file":"server.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"preact\"), require(\"node-fetch\"), require(\"cheerio\"), require(\"preact-render-to-string\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"preact\", \"node-fetch\", \"cheerio\", \"preact-render-to-string\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"preact\"), require(\"node-fetch\"), require(\"cheerio\"), require(\"preact-render-to-string\")) : factory(root[\"preact\"], root[\"node-fetch\"], root[\"cheerio\"], root[\"preact-render-to-string\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 23);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 9ab5879cb0e2e6d8b6da","module.exports = require(\"preact\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"preact\"\n// module id = 0\n// module chunks = 0","/*\n * The site's connection to, and representation of, the Atlassian Confluence wiki.\n *\n * The general principle is that this module isolates anything specific to\n * Confluence. If we were to change to a different wiki back-end, this module\n * would get replaced, but much of the rest of the server could stay the same.\n */\n\n\n// Cheerio is a server-side HTML jQuery-style parser/manipulator.\nconst cheerio = require('cheerio');\nconst fetch = require('node-fetch');\n\nconst BASE_URL = 'https://presterity.atlassian.net';\nconst REST_URL = `${BASE_URL}/wiki/rest/api/content`;\nconst SEARCH_URL = `${REST_URL}/search?cql=space=DB and `;\n\nconst HOME_PAGE_TITLE = 'Home';\nconst LINKS_PLACEHOLDER = `(Topic links will automatically appear here.)`;\n\n// Replace links to label pages with equivalent site URLs.\nconst labelUrlRegex = new RegExp(`${BASE_URL}/wiki/label/DB/([^\"]+)`);\n\n// Replace links to regular pages with equivalent site URLs.\nconst pageUrlRegex = /\\/wiki\\/display\\/DB\\/([^\"]+)/;\n\n// Replace links to viewpage.action URLs.\n// Confluence uses such links if a page's title contains odd characters.\nconst viewpageUrlRegex = /\\/wiki\\/pages\\/viewpage\\.action\\?pageId=(\\d+)/;\n\n\n// Map certain wiki page titles -> site URLs by hand.\nconst mapPageTitleToSiteUrl = {\n  'About': '/About',\n  'Development+volunteers': '/Volunteering/Development+volunteers',\n  'Home': '/',\n  'Submissions': '/Submissions',\n  'Volunteering': '/Volunteering',\n  'Code+of+Conduct': '/Volunteering/Code+of+Conduct'\n};\n\n\n/*\n * Format a page title for use in a wiki URL.\n */\nfunction escapePageTitle(title) {\n  return title.replace(/ /g, '+');\n}\n\n/*\n * Return a promise for the title for the page with the given ID.\n */\nfunction getTitleForPageWithId(pageId) {\n  const query = `${REST_URL}/${pageId}`;\n  return fetch(query)\n  .then(response => response.json())\n  .then(json => {\n    const title = escapePageTitle(json.title);\n    return title;\n  });\n}\n\n/*\n * Return the site URL for the label page for the given label.\n */\nfunction labelToSiteUrl(label) {\n  // Use hand-mapped URL if it exists.\n  return `/reference/label/${label}`;\n}\n\n/*\n * Return the site URL for the regular page with the given title.\n */\nfunction pageTitleToSiteUrl(title) {\n  // Use hand-mapped URL if it exists.\n  // All other pages are presented in the \"/reference\" area of the site.\n  const escaped = escapePageTitle(title);\n  return mapPageTitleToSiteUrl[escaped] || `/reference/${escaped}`;\n}\n\nfunction replacePlaceholderWithLinks(html, linksHtml) {\n  const placeholder = `<em>${LINKS_PLACEHOLDER}</em>`;\n  return html.replace(placeholder, linksHtml);\n}\n\n/*\n * Rewrite the indicated attribute of the given element if necessary.\n */\nfunction rewriteElementAttribute($element, attributeName) {\n\n  const attributeValue = $element.attr(attributeName);\n\n  const labelUrlMatch = labelUrlRegex.exec(attributeValue);\n  if (labelUrlMatch) {\n    const label = labelUrlMatch[1];\n    const rewritten = labelToSiteUrl(label);\n    $element.attr(attributeName, rewritten);\n    return; // No more processing necessary.\n  }\n\n  const pageUrlMatch = pageUrlRegex.exec(attributeValue);\n  if (pageUrlMatch) {\n    const title = pageUrlMatch[1];\n    const rewritten = pageTitleToSiteUrl(title);\n    $element.attr(attributeName, rewritten);\n    return;\n  }\n\n  const viewpageUrlMatch = viewpageUrlRegex.exec(attributeValue);\n  if (viewpageUrlMatch) {\n    const pageId = viewpageUrlMatch[1];\n    const rewritten = `/reference/id/${pageId}`;\n    $element.attr(attributeName, rewritten);\n  }\n}\n\n// Rewrite HTML for public consumption.\nfunction rewriteHtml(html) {\n  const $ = cheerio.load(html); // Parse HTML\n\n  // Rewrite wiki-relative links in `href` attributes.\n  $('a[href]').each((index, element) => {\n    rewriteElementAttribute($(element), 'href');\n  });\n\n  // Remove internal project notes.\n  // These are indicated as `em` (italics) nodes that begin and end with\n  // parentheses.\n  $('em').each((index, element) => {\n    const $element = $(element);\n    const text = $element.text().trim();\n    if (text === LINKS_PLACEHOLDER) {\n      // Leave links placeholder alone; it'll be handled separately.\n      return;\n    }\n    const isInternalNote = text.startsWith('(') && text.endsWith(')');\n    if (isInternalNote) {\n      $element.remove();\n    }\n  });\n\n  return $.html(); // Return rewritten HTML\n}\n\n// Return a promise for an array of wiki pages containing the given search text.\n//\n// This constructs a search query in Atlassian Confluence CQL:\n// https://developer.atlassian.com/confdev/confluence-server-rest-api/advanced-searching-using-cql\nfunction search(searchText) {\n  const escapedText = encodeURIComponent(searchText);\n  const query = `${SEARCH_URL}text~\"${escapedText}\"`;\n  console.log(`Search for: ${query}`);\n  return fetch(query)\n  .then(response => response.json())\n  .then(json => json.results);\n}\n\nfunction unescapePageTitle(escapedPageTitle) {\n  return escapedPageTitle.replace(/\\+/g, ' ');\n}\n\n// Return a promise for the wiki page with the given title.\n// The result is a JSON structured returned by Confluence. Wiki-relative paths\n// in the result will be modified to refer to URLs on our site instead.\nfunction wikiPageWithTitle(title) {\n  const query = `${REST_URL}?spaceKey=DB&title=${title}&expand=space,ancestors,body.view`;\n  console.log(`Page: ${query}`);\n  return fetch(query)\n  .then(response => response.json())\n  .then(json => {\n\n    // Usually we get a single result, but under some conditions (can't recall\n    // which) it's an array.\n    const pageJson = json.results instanceof Array ?\n      json.results[0] :\n      json;\n\n    if (!pageJson) {\n      return null;\n    }\n\n    const ancestors = pageJson.ancestors;\n    const title = pageJson.title;\n    const wikiBody = pageJson.body.view.value;\n\n    // The body will include link which are relative to the wiki.\n    // We fix those up so they refer to URLs on our site instead.\n    const body = rewriteHtml(wikiBody);\n\n    return { ancestors, body, title };\n  });\n}\n\n\nmodule.exports = {\n  BASE_URL,\n  escapePageTitle,\n  getTitleForPageWithId,\n  HOME_PAGE_TITLE,\n  labelToSiteUrl,\n  pageTitleToSiteUrl,\n  replacePlaceholderWithLinks,\n  REST_URL,\n  rewriteHtml,\n  search,\n  unescapePageTitle,\n  wikiPageWithTitle\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/connectors/wiki.js","import { Component, h } from 'preact'; // jshint ignore:line\nimport BreadcrumbBar from './BreadcrumbBar';\nimport Footer from './Footer';\nimport SideNavigation from './SideNavigation';\nimport TopNavigation from './TopNavigation';\n\n\n/**\n * Template for a standard page on the site.\n */\nexport default class StandardPage extends Component {\n\n  get asyncProperties() {\n    return SideNavigation.prototype.asyncProperties; // Same for all instances.\n  }\n\n  render(props) {\n    const area = getArea(props);\n\n    return (\n      <div class=\"pageWrapper\" area={area}>\n        <SideNavigation navigation={props.navigation}/>\n        <div class=\"main\">\n          <TopNavigation/>\n          <div class=\"breadcrumbBar\">\n            <div class=\"gutter\"></div>\n            <BreadcrumbBar ancestors={props.ancestors}/>\n            <div class=\"gutter\"></div>\n          </div>\n          <div class=\"articleContainer\">\n            <div class=\"gutter\"></div>\n            <article class=\"wikiContent\">\n              <img id=\"mobileHomeLogo\" src=\"/static/appIcon.png\" alt=\"Presterity logo: a torch and a book\"/>\n              <h1 class=\"pageTitle\">{props.title}</h1>\n              <div>\n                {props.children}\n              </div>\n              <Footer title={props.title} url={props.url}>{props.footer}</Footer>\n            </article>\n            <div class=\"gutter\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n}\n\n\n// Return the site area in which this page is shown under.\nfunction getArea(props) {\n  const ancestors = props.ancestors;\n  if (!ancestors) {\n    // Unknown\n    return '';\n  } else if (ancestors.length === 0 && props.title === 'Presterity') {\n    // Home page is in the \"Home\" area.\n    return 'Home';\n  } else if (ancestors.length === 0) {\n    // Top-level pages (Search, Volunteering, Submissions) are their own areas.\n    return props.title;\n  } else if (ancestors[0].title === 'Home') {\n    // Pages beneath Home area in the \"Reference\" area.\n    return 'Reference';\n  } else if (ancestors.length > 0) {\n    // Other pages fall under their top ancestor.\n    return ancestors[0].title;\n  } else {\n    // Unknown.\n    return '';\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/PageTemplate.jsx","module.exports = require(\"node-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-fetch\"\n// module id = 3\n// module chunks = 0","import { Component, h } from 'preact'; // jshint ignore:line\nimport Bookmark from './Bookmark';\n\n\n/**\n * A list (actually, a table) of bookmarks whose tags include a given title.\n */\nexport default class BookmarkList extends Component {\n\n  render(props) {\n    const bookmarks = props.bookmarks.map(bookmarkProps => (\n      <Bookmark {...bookmarkProps} excludeTag={props.excludeTag}/>\n    ));\n    return (\n      <table class=\"topicLinks\">{bookmarks}</table>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/BookmarkList.jsx","/*\n * The site's connection to, and representation of, the Raindrop bookmark API.\n *\n * The general principle is that this module isolates anything specific to\n * Raindrop. If we were to change to a different bookmarks back-end, this module\n * would get replaced, but much of the rest of the server could stay the same.\n *\n * Raindrop bookmark results are paginated: http://raindrop.io/dev/docs#bookmarks.\n * The first page of results includes a `count` property indicating how many\n * total results there are. Once we have that, we know how many more pages of\n * results to ask for.\n *\n * To keep the client as simple as possible, we get *all* bookmarks for a given\n * topic at once. This works at a small scale, but will become slow as we gather\n * 100s of bookmarks per topic. On the plus side:\n *\n * * Since we have server-side caching, once someone visits a page, subsequent\n *   visitors within the cache interval will immediately get a complete page of\n *   results.\n *\n * * This also means that only our server is hitting Raindrop, reducing the\n *   degree to which we may annoy them.\n *\n * At some point, we'd like to have our own DB of bookmarks, and at that point\n * should add infinite-scrolling to the client so the client can request only\n * those results it actually needs to fill the page.\n */\n\n\nconst fetch = require('node-fetch');\n\nconst PRESTERITY_BOOKMARK_COLLECTION_ID = 2021037;\nconst RAINDROP_REST_URL = `https://raindrop.io/api/raindrops/${PRESTERITY_BOOKMARK_COLLECTION_ID}`;\nconst MAX_BOOKMARKS_PER_PAGE = 40; // Limit imposed by Raindrop.\n\n\n/*\n * Return a promise for the complete set of bookmarks on the given topic.\n * The topic is identified with a string: \"Trump Cabinet\".\n *\n * The bookmarks are returned sorted by bookmark title. Since we start bookmark\n * titles with a date in YYYY.MM.DD format, the bookmarks will also be sorted\n * by date.\n */\nfunction bookmarksForTopic(topic) {\n\n  let bookmarks;\n\n  // Fetch the initial results: page 0.\n  return getResultsForPage(topic, 0)\n  .then(resultPage0 => {\n\n    // Save the page 0 bookmarks.\n    bookmarks = resultPage0.items;\n\n    // The results include a `count` property that gives the total number of\n    // bookmarks. Use this to calculate how many more pages we need fetch.\n    const bookmarkCount = resultPage0.count;\n    const pageCount = Math.ceil(bookmarkCount / MAX_BOOKMARKS_PER_PAGE);\n\n    // Now get pages 1..pageCount.\n    return getResultsForPages(topic, pageCount);\n  })\n  .then(additionalResultPages => {\n\n    // Combine bookmarks from additional pages (if any) with set from page 0.\n    additionalResultPages.forEach(resultPage => {\n      bookmarks = bookmarks.concat(resultPage.items);\n    });\n\n    // Raindrop's sorting facilities are limited, so we sort ourselves.\n    const sorted = bookmarks.sort(compareBookmarks);\n\n    return sorted;\n  });\n}\n\n// Sort two bookmarks by title.\n// Since the title should start with a date like 2017.01.13, sorting by title\n// should produce a chronological sort.\nfunction compareBookmarks(bookmark1, bookmark2) {\n  if (bookmark1.title < bookmark2.title) {\n    return -1;\n  }\n  if (bookmark1.title > bookmark2.title) {\n    return 1;\n  }\n  return 0;\n}\n\n// Return a promise for the indicated page of results for the given topic.\nfunction getResultsForPage(topic, pageNumber) {\n  const escapedTopic = encodeURIComponent(topic);\n  const url = `${RAINDROP_REST_URL}?search=[{\"key\":\"tag\",\"val\":\"${escapedTopic}\"}]&perpage=${MAX_BOOKMARKS_PER_PAGE}&page=${pageNumber}`;\n  console.log(`Bookmarks: ${url}`);\n  return fetch(url)\n  .then(response => response.json());\n}\n\n// Return the latest bookmarks, up to a maximum of count (but no more than 40).\n// The default count is 10.\nfunction mostRecentBookmarks(count = 10) {\n  const url = `${RAINDROP_REST_URL}?perpage=${count}`;\n  console.log(`Latest bookmarks: ${url}`);\n  return fetch(url)\n  .then(response => response.json())\n  .then(json => json.items);\n}\n\n// Return a promise for pages 1..pageCount of bookmarks for the given topic.\n// This does *not* get the bookmarks on page 0. We handle those separately.\n// Accordingly, if pageCount is 0 or 1, this returns a resolved promise for\n// an empty array.\nfunction getResultsForPages(topic, pageCount) {\n  let promises = [];\n  for (let page = 1; page < pageCount; page++) {\n    promises = promises.concat(getResultsForPage(topic, page));\n  }\n  return Promise.all(promises);\n}\n\nmodule.exports = {\n  bookmarksForTopic,\n  mostRecentBookmarks\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/connectors/bookmarks.js","module.exports = require(\"cheerio\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cheerio\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"preact-render-to-string\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"preact-render-to-string\"\n// module id = 7\n// module chunks = 0","import { Component, h } from 'preact'; // jshint ignore:line\n\n\nexport default class AppShell extends Component {\n\n  render(props) {\n\n    const titleBar =\n      props.titleBar ||\n      (props.title && `${props.title} - Presterity`) ||\n      '';\n\n    // JSX gets confused by JavaScript inside a script tag, so we define it as\n    // as a string and inject it below.\n    const analytics = `\n      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;\n      ga('create', 'UA-90582272-1', 'auto');\n      ga('send', 'pageview');\n    `;\n\n    return (\n      <html lang=\"en\">\n        <head>\n          <meta charset=\"utf-8\"/>\n          <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\"/>\n          <title>{titleBar}</title>\n          <link rel=\"stylesheet\" href=\"/static/main.css\"/>\n          <link rel=\"shortcut icon\" href=\"/static/favicon.ico\" type=\"image/x-icon\" />\n          <link rel=\"apple-touch-icon\" sizes=\"144x144\" href=\"/static/appIcon.png\" />\n          <link rel=\"manifest\" href=\"/static/manifest.json\" />\n          <meta name=\"google-site-verification\" content=\"4TmUwdRDIEbTE65Bw8HwEyVZqJthy2MvT0S327h_Gdg\" />\n          <meta property=\"og:title\" content={props.title} />\n          <meta property=\"og:url\" content={props.url} />\n          <meta property=\"og:image\" content={`${props.baseUrl}/static/facebookShare.png`} />\n          <script dangerouslySetInnerHTML={{ __html: analytics }}></script>\n          <script async src='https://www.google-analytics.com/analytics.js'></script>\n        </head>\n        <body area={props.area}>\n          <div id=\"root\">\n            {props.children}\n          </div>\n        </body>\n      </html>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/AppShell.jsx","import ErrorPage from './ErrorPage';\nimport HomePage from './HomePage';\nimport NotFoundPage from './NotFoundPage';\nimport SearchPage from './SearchPage';\nimport WikiPage from './WikiPage';\n\n\n/**\n * Map routes to components.\n */\nexport default {\n  '/error': ErrorPage,\n  '/notfound': NotFoundPage, // TODO: Remove\n  '/search': SearchPage,\n  '/:title': WikiPage,\n  '/:area/:title': WikiPage,\n  '/': HomePage\n};\n\n\n\n// WEBPACK FOOTER //\n// ./components/routes.js","import { Component, h } from 'preact'; // jshint ignore:line\nimport wiki from '../server/connectors/wiki';\n\n\n/**\n * Return a bookmark from the server as HTML for presentation to the user.\n * This will be a row intended for display in a table.\n *\n * The result will include \"See also\" links to topics tagged on the bookmark. If\n * an \"excludeTag\" property has been supplied, a \"See also\" link will *not* be\n * included for the indicated topic (since the user will already be looking at\n * that page).\n */\nexport default class Bookmark extends Component {\n\n  render(props) {\n\n    let domain = props.domain;\n    if (domain.startsWith('www.')) {\n      domain = domain.slice(4); // Remove \"www.\"\n    }\n\n    // Our bookmark format has writers put the date of an event in the bookmark\n    // title. Parse that out.\n    const { date, text } = parseLinkTitle(props.title);\n\n    // Construct list of bookmark tags. If a current title has been supplied,\n    // *don't* include that tag. Otherwise, include all tags.\n    const tags = props.tags\n      .filter(tag => tag !== props.excludeTag)\n      .map((tag, index) => {\n        const url = `/reference/${wiki.escapePageTitle(tag)}`;\n        const comma = index > 0 ? ', ' : '';\n        return (\n          <span>\n            {comma}\n            <a href={url}>{tag}</a>\n          </span>\n        );\n      });\n\n    let seeAlsoSection = null;\n    if (tags.length > 0) {\n      const seeLabel = props.excludeTag ? 'See also' : 'See';\n      seeAlsoSection = (\n        <span>({seeLabel} {tags})</span>\n      );\n    }\n\n    // The bookmark may have an optional description (\"excerpt\").\n    const excerpt = props.excerpt ?\n      (\n        <div>\n          <div class=\"excerpt\">{props.excerpt}</div>\n        </div>\n      ) :\n      null;\n\n    return (\n      <tr>\n        <td>{date}</td>\n        <td>\n          {text}&nbsp;\n          <a href={props.link}>{domain}</a>&nbsp;\n          {seeAlsoSection}\n          {excerpt}\n        </td>\n      </tr>\n    );\n  }\n\n}\n\n\nfunction parseLinkTitle(title) {\n  // Find link parts:\n  // * optional whitespace to start\n  // * date in 2017.01.17 format, can also use hyphens\n  // * whitespace\n  // * remaining text\n  const linkPartsRegex = /^\\s*([\\d\\.-]+)\\s+(.*)/;\n  const match = linkPartsRegex.exec(title);\n  let date;\n  let text;\n  if (match) {\n    date = match[1];\n    text = match[2];\n  } else {\n    date = '';\n    text = title;\n  }\n  return { date, text };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/Bookmark.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nconst wiki = require('../server/connectors/wiki');\n\n\n/**\n * Breadcrumb bar\n */\nexport default class BreadcrumbBar extends Component {\n\n  render(props) {\n\n    // Pages without known ancestors get \"Home\" as their default ancestor.\n    const ancestors = props.ancestors || [{ title: 'Home' }];\n\n    const breadcrumbs = ancestors.map((ancestor, index) => {\n      const title = ancestor.title;\n      const siteUrl = wiki.pageTitleToSiteUrl(title);\n      const separator = index > 0 ? ' / ' : '';\n      return (\n        <span>\n          {separator}\n          <a href={siteUrl}>{title}</a>\n        </span>\n      );\n    });\n\n    return (\n      <div class=\"breadcrumbs\">{breadcrumbs}</div>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/BreadcrumbBar.jsx","import { Component, h } from 'preact'; // jshint ignore:line\n\n\n/**\n * Show a count of the days remaining in the administration.\n */\nexport default class DaysRemaining extends Component {\n\n  render(props) {\n\n    const today = new Date(Date.now());\n    const inaugurationDate = new Date(Date.parse('Mon, Jan 20 2021 12:00:00 EST'));\n\n    // From \"a more correct solution\" for date diff math:\n    // http://stackoverflow.com/a/15289883/76472.\n    const utc1 = Date.UTC(today.getFullYear(), today.getMonth(), today.getDate());\n    const utc2 = Date.UTC(inaugurationDate.getFullYear(), inaugurationDate.getMonth(), inaugurationDate.getDate());\n    const diffMilliseconds = utc2 - utc1;\n    const MILLISECONDS_PER_DAY = 24 * 60 * 60 * 1000;\n    const diffDays = Math.floor(diffMilliseconds / MILLISECONDS_PER_DAY);\n\n    let message;\n    if (diffDays === 0) {\n      message = (\n        <strong>This is the last day of the Trump administration!</strong>\n      );\n    } else if (diffDays > 0) {\n      const days = diffDays === 1 ? 'day' : 'days';\n      message = (\n        <span>\n          There are only <strong>{diffDays}</strong> {days} to go in the Trump\n          administration.\n        </span>\n      );\n    } else {\n      // Administration is over. Whew.\n      message = '';\n    }\n\n    return (\n      <p id=\"daysRemainingMessage\">\n        {message}\n      </p>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/DaysRemaining.jsx","import { h } from 'preact'; // jshint ignore:line\nimport PageTemplate from './PageTemplate';\n\n\n/**\n * Error page.\n */\nexport default class ErrorPage extends PageTemplate {\n\n  render(props) {\n    return (\n      <PageTemplate\n          navigation={props.navigation}\n          title={this.title}\n          url={props.url}\n        >\n        <p>\n          Sorry, something went wrong. 😞\n        </p>\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    return \"Oops\";\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/ErrorPage.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nimport DaysRemaining from './DaysRemaining';\nimport TweetButton from './TweetButton';\n\n/**\n * Standard template footer\n */\nexport default class Footer extends Component {\n\n  render(props) {\n    return (\n      <footer>\n        <p>\n          <TweetButton text={props.title} url={props.url}/>\n        </p>\n        {props.children}\n        <DaysRemaining/>\n      </footer>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/Footer.jsx","import { h } from 'preact'; // jshint ignore:line\nimport bookmarks from '../server/connectors/bookmarks';\nimport BookmarkList from './BookmarkList';\nimport PageTemplate from './PageTemplate';\nimport render from 'preact-render-to-string';\nimport wiki from '../server/connectors/wiki';\n\n\n/**\n * The Home page.\n *\n * This is a variant of the usual wiki page that shows the latest links\n * instead of links based on their tags.\n */\nexport default class HomePage extends PageTemplate {\n\n  get asyncProperties() {\n\n    const title = this.title;\n\n    // Load the wiki page with the given title.\n    const pagePromise = wiki.wikiPageWithTitle(title)\n    .then(wikiPage => {\n      if (!wikiPage) {\n        // If we can't find the Home page, it's an error.\n        throw `Couldn't find the wiki content for a page titled \"${title}\".`;\n      }\n      return {\n        ancestors: wikiPage.ancestors,\n        body: wikiPage.body\n      };\n    });\n\n    // Load the most recent bookmarks.\n    const requestBookmarkCount = 5;\n    const bookmarksPromise = bookmarks.mostRecentBookmarks(requestBookmarkCount)\n    .then(bookmarks => {\n      return { bookmarks };\n    });\n\n    // Merge the above with the base class' async properties.\n    return Promise.all([super.asyncProperties, pagePromise, bookmarksPromise])\n    .then(results => {\n      return Object.assign.apply({}, results);\n    });\n  }\n\n  render(props) {\n\n    // Merge the bookmark list into the wiki page body to construct the final\n    // page body.\n    const bookmarkList = (\n      <BookmarkList bookmarks={props.bookmarks} excludeTag={this.title}/>\n    );\n    const bookmarkListHtml = render(bookmarkList);\n    const body = wiki.replacePlaceholderWithLinks(props.body, bookmarkListHtml);\n\n    return (\n      <PageTemplate\n          ancestors={props.ancestors}\n          navigation={props.navigation}\n          title=\"Presterity\"\n          url={props.url}\n        >\n        <div dangerouslySetInnerHTML={{ __html: body }} />\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    return 'Home';\n  }\n\n  get titleBar() {\n    return 'Presterity';\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/HomePage.jsx","import { h } from 'preact'; // jshint ignore:line\nimport PageTemplate from './PageTemplate';\n\n\n/**\n * \"Not Found\" page.\n */\nexport default class NotFoundPage extends PageTemplate {\n\n  render(props) {\n    return (\n      <PageTemplate\n          ancestors={props.ancestors}\n          footer={props.footer}\n          navigation={props.navigation}\n          title={this.title}\n          url={props.url}\n        >\n        <p>\n          We don&rsquo;t have a page for &ldquo;{this.title}&rdquo; yet!\n        </p>\n        <p>\n          Would you consider <a href=\"/Volunteering\">volunteering</a> and\n          helping us make one?\n        </p>\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    // TODO: Pass in title when constructing page.\n    // return this.props.title;\n    return \"Not Found\";\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/NotFoundPage.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nconst navigationPane = require('../server/pages/navigationPane');\n\n\n/**\n * Side navigation pane\n */\nexport default class SideNavigation extends Component {\n\n  get asyncProperties() {\n    return navigationPane()\n    .then(html => {\n      return {\n        navigation: html\n      };\n    });\n  }\n\n  render(props) {\n    return (\n      <nav class=\"sideNavigation\">\n        <div id=\"logoBlock\">\n          <a id=\"linkHome\" href=\"/\">\n            <img id=\"logo\" src=\"/static/presterity.png\" alt=\"Presterity logo: a torch and a book\"/>\n          </a>\n        </div>\n        <p id=\"tableOfContentsCaption\">\n          TABLE <em>of</em> CONTENTS\n        </p>\n        <div id=\"captionSeparatorContainer\">\n          <div id=\"captionSeparator\"></div>\n        </div>\n        <div class=\"sideNavigation\" dangerouslySetInnerHTML={{ __html: props.navigation }} />\n      </nav>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/SideNavigation.jsx","import { h } from 'preact'; // jshint ignore:line\n\n\n/**\n * Top navigation links\n */\nexport default (props) => (\n  <header id=\"topNavigation\">\n    <div class=\"gutter\"></div>\n    <div id=\"topLinks\">\n      <a id=\"linkAbout\" href=\"/About\">ABOUT</a>&nbsp;\n      <a id=\"linkVolunteering\" href=\"/Volunteering\">VOLUNTEER</a>&nbsp;\n      <a id=\"linkSearch\" href=\"/search\">SEARCH</a>&nbsp;\n      <a id=\"linkSubmissions\" href=\"/Submissions\">SUBMIT NEWS</a>\n    </div>\n    <div class=\"gutter\"></div>\n  </header>\n);\n\n\n\n// WEBPACK FOOTER //\n// ./components/TopNavigation.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nimport TwitterIcon from './TwitterIcon';\n\n\nexport default class TweetButton extends Component {\n\n  render(props) {\n    const encodedText = encodeURIComponent(props.text);\n    const encodedUrl = encodeURIComponent(props.url);\n    const href = `https://twitter.com/intent/tweet?via=presterity&text=${encodedText}&url=${encodedUrl}`;\n    return (\n      <a class=\"tweetButton\" href={href}>\n        <TwitterIcon fill=\"#fff\"/>\n        <span>Share</span>\n      </a>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/TweetButton.jsx","import { h } from 'preact'; // jshint ignore:line\n\n\n/**\n * Top navigation links\n */\nexport default (props) => {\n  const fill = props.fill || 'black';\n  return (\n    <svg viewBox=\"0 0 182.66667 150.66667\" style={`fill: ${fill};`}>\n      <g xmlns=\"http://www.w3.org/2000/svg\" id=\"g10\" transform=\"matrix(1.3333 0 0 -1.3333 0 150.67)\">\n        <g transform=\"scale(.1)\">\n          <path d=\"m1366.9 989.39c-50.27-22.309-104.33-37.387-161.05-44.18 57.89 34.723 102.34 89.679 123.28 155.15-54.18-32.15-114.18-55.47-178.09-68.04-51.13 54.49-124.02 88.55-204.68 88.55-154.89 0-280.43-125.55-280.43-280.43 0-21.988 2.457-43.398 7.258-63.91-233.08 11.68-439.72 123.36-578.04 293.01-24.141-41.4-37.969-89.567-37.969-140.97 0-97.308 49.489-183.13 124.76-233.44-45.969 1.437-89.218 14.058-127.03 35.078-0.043-1.18-0.043-2.348-0.043-3.52 0-135.9 96.68-249.22 224.96-275-23.512-6.41-48.281-9.8-73.86-9.8-18.089 0-35.628 1.711-52.781 5 35.711-111.41 139.26-192.5 262-194.77-96.058-75.23-216.96-120.04-348.36-120.04-22.621 0-44.961 1.332-66.918 3.91 124.16-79.568 271.55-125.98 429.94-125.98 515.82 0 797.86 427.31 797.86 797.93 0 12.153-0.28 24.223-0.79 36.25 54.77 39.571 102.31 88.95 139.93 145.2\"></path>\n        </g>\n      </g>\n    </svg>\n  );\n};\n\n\n\n// WEBPACK FOOTER //\n// ./components/TwitterIcon.jsx","import { h } from 'preact'; // jshint ignore:line\nimport bookmarks from '../server/connectors/bookmarks';\nimport BookmarkList from './BookmarkList';\nimport PageTemplate from './PageTemplate';\nimport render from 'preact-render-to-string';\nimport wiki from '../server/connectors/wiki';\n\n\n/**\n * A page that renders content from the Atlassian wiki.\n */\nexport default class WikiPage extends PageTemplate {\n\n  get asyncProperties() {\n\n    const title = this.title;\n\n    // Load the wiki page with the given title.\n    const pagePromise = wiki.wikiPageWithTitle(title)\n    .then(wikiPage => {\n      return {\n        ancestors: wikiPage.ancestors,\n        body: wikiPage.body\n      };\n    });\n\n    // Load the bookmarks tagged with the same title.\n    const bookmarksPromise = bookmarks.bookmarksForTopic(title)\n    .then(bookmarks => {\n      return { bookmarks };\n    });\n\n    // Merge the above with the base class' async properties.\n    return Promise.all([super.asyncProperties, pagePromise, bookmarksPromise])\n    .then(results => {\n      return Object.assign.apply({}, results);\n    });\n  }\n\n  render(props) {\n\n    // Merge the bookmark list into the wiki page body to construct the final\n    // page body.\n    const bookmarkList = (\n      <BookmarkList bookmarks={props.bookmarks} excludeTag={this.title}/>\n    );\n    const bookmarkListHtml = render(bookmarkList);\n    const body = wiki.replacePlaceholderWithLinks(props.body, bookmarkListHtml);\n\n    const footer = (\n      <div>\n        <p>\n          You can <a href=\"/Submissions\">submit news</a> on this topic.\n          If something's wrong on this\n          page, <a href=\"/Volunteering\">help us fix it</a>.\n        </p>\n        <p>\n          This work is licensed under\n          a <a rel=\"license\" href=\"https://creativecommons.org/licenses/by/4.0/\">Creative Commons Attribution 4.0 International License</a>.\n        </p>\n      </div>\n    );\n\n    return (\n      <PageTemplate\n          ancestors={props.ancestors}\n          navigation={props.navigation}\n          title={this.title}\n          url={props.url}\n          footer={footer}\n        >\n        <div dangerouslySetInnerHTML={{ __html: body }} />\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    const requestTitle = this.props.request.params.title;\n    const title = wiki.unescapePageTitle(requestTitle);\n    return title;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/WikiPage.jsx","const cheerio = require('cheerio');\nconst fetch = require('node-fetch');\nconst wiki = require('../connectors/wiki');\n\n\n// Time in milliseconds we should cache the navigation.\nconst NAVIGATION_CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\n// The Date.now() timestamp of our last request for the navgation.\nlet navigationTimestamp = 0;\n\n// The cached navigation HTML.\nlet cachedNavigationHtml;\n\n\n/*\n * Return a promise for the HTML that should be used in the navigation pane.\n *\n * The content for the pane is maintained on a special page on the wiki with\n * the title \"Navigation\". That page isn't directly accessible through the\n * site navigation, and is only used here to construct the navigation UI.\n *\n * Because the navigation outline doesn't change often, we cache the result for\n * a period before asking for it again. The same navigation pane is shared\n * across all pages that use the pane.\n */\nmodule.exports = () => {\n  const needsRefresh = cachedNavigationHtml == null ||\n      (Date.now() - navigationTimestamp) > NAVIGATION_CACHE_DURATION;\n  if (needsRefresh) {\n    // Get navigation from server.\n    return getNavigationFromWiki()\n    .then(html => {\n      cachedNavigationHtml = html;\n      return html;\n    });\n  } else {\n    // Return cached result.\n    return Promise.resolve(cachedNavigationHtml);\n  }\n};\n\n\n// Returns a promise to get the navigation HTML from the wiki.\nfunction getNavigationFromWiki() {\n  const title = 'Navigation';\n  const query = `${wiki.REST_URL}?spaceKey=DB&title=${title}&expand=body.view`;\n  console.log(`Navigation: ${query}`);\n  return fetch(query)\n  .then(response => response.json())\n  .then(wikiResults => {\n    navigationTimestamp = Date.now(); // Note the time we got this response.\n\n    const wikiPageJson = wikiResults.results[0];\n    const body = wikiPageJson.body.view.value;\n\n    // Map wiki-relative URLs to our own routes.\n    const rewrittenHtml = wiki.rewriteHtml(body);\n\n    // For each list item in the navigation pane, add an attribute on it that\n    // will help us reflect the user's current position in the outline using\n    // styling applied with CSS that matches that attribute. The goal of this\n    // is to avoid having to update the navigation links for individual pages.\n    const $ = cheerio.load(rewrittenHtml); // Parse HTML\n    // Find all list items.\n    $('li').each((index, li) => {\n      const $li = $(li); // Get list item.\n      const $a = $($li.children('a')[0]); // Get the anchor tag within it.\n      if ($a) {\n        // Get the anchor's text. This will be the page title.\n        const text = $a.text();\n        // Expose that text on the list item as an attribute.\n        $li.attr('navigation-item', text);\n      }\n    });\n\n    const navigationPaneHtml = $.html();\n    return navigationPaneHtml;\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/pages/navigationPane.js","import AppShell from './AppShell';\nimport routes from './routes';\n\n\n/**\n * Single export for all components.\n */\nexport { AppShell, routes };\n\n\n\n// WEBPACK FOOTER //\n// ./components/Components.jsx","import { h } from 'preact'; // jshint ignore:line\nimport PageTemplate from './PageTemplate';\nimport SearchResultsList from './SearchResultsList';\nimport wiki from '../server/connectors/wiki';\n\n\n/**\n * The Search page, withour search results (new search) or with results.\n */\nexport default class SearchPage extends PageTemplate {\n\n  get asyncProperties() {\n\n    const searchText = this.props.request.query.q;\n\n    const isNewSearch = typeof searchText === 'undefined';\n    const searchPromise = isNewSearch ?\n      Promise.resolve() : // Don't need to search\n      wiki.search(searchText)\n        .then(searchResults => {\n          return {\n            results: searchResults\n          };\n        });\n\n    return Promise.all([super.asyncProperties, searchPromise])\n    .then(results => {\n      return Object.assign.apply({}, results);\n    });\n  }\n\n  render(props) {\n\n    const searchText = props.request.query.q;\n    const searchHeader = !props.results ?\n      null :\n      props.results.length > 0 ?\n        `Pages containing \"${searchText}\"` :\n        `No pages found`;\n\n    return (\n      <PageTemplate\n          ancestors={props.ancestors}\n          navigation={props.navigation}\n          title={this.title}\n          url={props.url}\n        >\n        <form>\n          Search for:&nbsp;\n          <input name=\"q\" type=\"text\" value={searchText} style=\"max-width: 50%;\"/>&nbsp;\n          <input type=\"submit\" value=\"Search\"/>\n        </form>\n        <h3>{searchHeader}</h3>\n        <SearchResultsList results={props.results}/>\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    return \"Search\";\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/SearchPage.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nconst wiki = require('../server/connectors/wiki');\n\n\n/*\n * Given Atlassian Confluence search results, return them as a bulleted list of\n * clickable links.\n */\nexport default class SearchResultsList extends Component {\n\n  render(props) {\n    const links = props.results && props.results.map(result => {\n      const title = result.title;\n      const escaped = wiki.escapePageTitle(title);\n      const href = `/reference/${escaped}`;\n      return (\n        <li><a href={href}>{title}</a></li>\n      );\n    });\n    return (\n      <ul>{links}</ul>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/SearchResultsList.jsx"],"sourceRoot":""}