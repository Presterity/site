{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap cd00b3ee0fbf26d9ac42","webpack:///external \"preact\"","webpack:///external \"cheerio\"","webpack:///external \"node-fetch\"","webpack:///./components/AppShell.jsx","webpack:///./components/Hello.jsx","webpack:///./components/PageTemplate.jsx","webpack:///./components/SideNavigation.jsx","webpack:///./components/TopNavigation.jsx","webpack:///./server/connectors/wiki.js","webpack:///./server/pages/navigationPane.js","webpack:///./components/Components.jsx","webpack:///./components/BreadcrumbBar.jsx","webpack:///./components/Footer.jsx","webpack:///./components/DaysRemaining.jsx","webpack:///./components/TweetButton.jsx","webpack:///./components/TwitterIcon.jsx","webpack:///./components/routes.js","webpack:///./components/ErrorPage.jsx","webpack:///./components/NotFoundPage.jsx","webpack:///./components/WikiPage.jsx","webpack:///./components/BookmarkList.jsx","webpack:///external \"preact-render-to-string\"","webpack:///./server/connectors/bookmarks.js","webpack:///./components/Bookmark.jsx"],"names":["AppShell","render","props","titleBar","title","url","baseUrl","children","Hello","navigation","StandardPage","asyncProperties","SideNavigation","prototype","ancestors","footer","navigationPane","require","then","html","__html","cheerio","fetch","BASE_URL","REST_URL","SEARCH_URL","HOME_PAGE_TITLE","LINKS_PLACEHOLDER","labelUrlRegex","RegExp","pageUrlRegex","viewpageUrlRegex","mapPageTitleToSiteUrl","escapePageTitle","replace","getTitleForPageWithId","pageId","query","response","json","labelToSiteUrl","label","pageTitleToSiteUrl","escaped","replacePlaceholderWithLinks","linksHtml","placeholder","rewriteElementAttribute","$element","attributeName","attributeValue","attr","labelUrlMatch","exec","rewritten","pageUrlMatch","viewpageUrlMatch","rewriteHtml","$","load","each","index","element","text","trim","isInternalNote","startsWith","endsWith","remove","unescapePageTitle","escapedPageTitle","wikiPageWithTitle","console","log","pageJson","results","Array","wikiBody","body","view","value","module","exports","wiki","NAVIGATION_CACHE_DURATION","navigationTimestamp","cachedNavigationHtml","needsRefresh","Date","now","getNavigationFromWiki","Promise","resolve","wikiResults","wikiPageJson","rewrittenHtml","li","$li","$a","navigationPaneHtml","BreadcrumbBar","breadcrumbs","map","ancestor","siteUrl","Footer","DaysRemaining","today","inaugurationDate","parse","utc1","UTC","getFullYear","getMonth","getDate","utc2","diffMilliseconds","MILLISECONDS_PER_DAY","diffDays","Math","floor","message","days","TweetButton","encodedText","encodeURIComponent","encodedUrl","href","fill","WikiPage","ErrorPage","NotFoundPage","pagePromise","wikiPage","bookmarksPromise","bookmarks","bookmarksForTopic","all","Object","assign","apply","bookmarkList","bookmarkListHtml","requestTitle","request","params","BookmarkList","bookmarkProps","excludeTag","PRESTERITY_BOOKMARK_COLLECTION_ID","RAINDROP_REST_URL","MAX_BOOKMARKS_PER_PAGE","topic","getResultsForPage","resultPage0","items","bookmarkCount","count","pageCount","ceil","getResultsForPages","additionalResultPages","forEach","resultPage","concat","sorted","sort","compareBookmarks","bookmark1","bookmark2","pageNumber","escapedTopic","mostRecentBookmarks","promises","page","Bookmark","domain","slice","date","parseLinkTitle","tags","filter","tag","comma","seeAlsoSection","length","seeLabel","excerpt","link","linkPartsRegex","match"],"mappings":"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","file":"server.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"preact\"), require(\"cheerio\"), require(\"node-fetch\"), require(\"preact-render-to-string\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"preact\", \"cheerio\", \"node-fetch\", \"preact-render-to-string\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"preact\"), require(\"cheerio\"), require(\"node-fetch\"), require(\"preact-render-to-string\")) : factory(root[\"preact\"], root[\"cheerio\"], root[\"node-fetch\"], root[\"preact-render-to-string\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_21__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap cd00b3ee0fbf26d9ac42","module.exports = require(\"preact\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"preact\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"cheerio\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cheerio\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"node-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-fetch\"\n// module id = 2\n// module chunks = 0","import { Component, h } from 'preact'; // jshint ignore:line\n\nexport default class AppShell extends Component {\n\n  render(props) {\n\n    const titleBar = props.titleBar ||\n        props.title ?\n          `${props.title} - Presterity` :\n          '';\n\n    return (\n      <html lang=\"en\">\n        <head>\n          <meta charset=\"utf-8\"/>\n          <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\"/>\n          <title>{titleBar}</title>\n          <link rel=\"stylesheet\" href=\"/static/main.css\"/>\n          <link rel=\"shortcut icon\" href=\"/static/favicon.ico\" type=\"image/x-icon\" />\n          <link rel=\"apple-touch-icon\" sizes=\"144x144\" href=\"/static/appIcon.png\" />\n          <link rel=\"manifest\" href=\"/static/manifest.json\" />\n          <meta name=\"google-site-verification\" content=\"4TmUwdRDIEbTE65Bw8HwEyVZqJthy2MvT0S327h_Gdg\" />\n          <meta property=\"og:title\" content={props.title} />\n          <meta property=\"og:url\" content={props.url} />\n          <meta property=\"og:image\" content={`${props.baseUrl}/static/facebookShare.png`} />\n        </head>\n        <body>\n          <div id=\"root\">\n            {props.children}\n          </div>\n        </body>\n      </html>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/AppShell.jsx","import { h } from 'preact'; // jshint ignore:line\nimport PageTemplate from './PageTemplate';\n\n\n/**\n * Test page\n */\nexport default class Hello extends PageTemplate {\n\n  render(props) {\n    return (\n      <PageTemplate\n          navigation={props.navigation}\n          title={this.title}\n          url={props.url}\n        >\n        <p>\n          Hello, world.\n        </p>\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    return \"Hello\";\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/Hello.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nimport BreadcrumbBar from './BreadcrumbBar';\nimport Footer from './Footer';\nimport SideNavigation from './SideNavigation';\nimport TopNavigation from './TopNavigation';\n\n\n/**\n * Template for a standard page on the site.\n */\nexport default class StandardPage extends Component {\n\n  get asyncProperties() {\n    return SideNavigation.prototype.asyncProperties; // Same for all instances.\n  }\n\n  render(props) {\n    return (\n      <div class=\"pageWrapper\">\n        <SideNavigation navigation={props.navigation}/>\n        <div class=\"main\">\n          <TopNavigation/>\n          <div class=\"breadcrumbBar\">\n            <div class=\"gutter\"></div>\n            <BreadcrumbBar ancestors={props.ancestors}/>\n            <div class=\"gutter\"></div>\n          </div>\n          <div class=\"articleContainer\">\n            <div class=\"gutter\"></div>\n            <article class=\"wikiContent\">\n              <img id=\"mobileHomeLogo\" src=\"/static/appIcon.png\" alt=\"Presterity logo: a torch and a book\"/>\n              <h1 class=\"pageTitle\">{props.title}</h1>\n              <div>\n                {props.children}\n              </div>\n              <Footer title={props.title} url={props.url}>{props.footer}</Footer>\n            </article>\n            <div class=\"gutter\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/PageTemplate.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nconst navigationPane = require('../server/pages/navigationPane');\n\n\n/**\n * Side navigation pane\n */\nexport default class SideNavigation extends Component {\n\n  get asyncProperties() {\n    return navigationPane()\n    .then(html => {\n      return {\n        navigation: html\n      };\n    });\n  }\n\n  render(props) {\n    return (\n      <nav class=\"sideNavigation\">\n        <div id=\"logoBlock\">\n          <a id=\"linkHome\" href=\"/\">\n            <img id=\"logo\" src=\"/static/presterity.png\" alt=\"Presterity logo: a torch and a book\"/>\n          </a>\n        </div>\n        <p id=\"tableOfContentsCaption\">\n          TABLE <em>of</em> CONTENTS\n        </p>\n        <div id=\"captionSeparatorContainer\">\n          <div id=\"captionSeparator\"></div>\n        </div>\n        <div class=\"sideNavigation\" dangerouslySetInnerHTML={{ __html: props.navigation }} />\n      </nav>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/SideNavigation.jsx","import { h } from 'preact'; // jshint ignore:line\n\n\n/**\n * Top navigation links\n */\nexport default (props) => (\n  <header id=\"topNavigation\">\n    <div class=\"gutter\"></div>\n    <div id=\"topLinks\">\n      <a id=\"linkAbout\" href=\"/About\">ABOUT</a>\n      <a id=\"linkVolunteering\" href=\"/Volunteering\">VOLUNTEER</a>\n      <a id=\"linkSearch\" href=\"/search\">SEARCH</a>\n      <a id=\"linkSubmissions\" href=\"/Submissions\">SUBMIT NEWS</a>\n    </div>\n    <div class=\"gutter\"></div>\n  </header>\n);\n\n\n\n// WEBPACK FOOTER //\n// ./components/TopNavigation.jsx","/*\n * The site's connection to, and representation of, the Atlassian Confluence wiki.\n *\n * The general principle is that this module isolates anything specific to\n * Confluence. If we were to change to a different wiki back-end, this module\n * would get replaced, but much of the rest of the server could stay the same.\n */\n\n\n// Cheerio is a server-side HTML jQuery-style parser/manipulator.\nconst cheerio = require('cheerio');\nconst fetch = require('node-fetch');\n\nconst BASE_URL = 'https://presterity.atlassian.net';\nconst REST_URL = `${BASE_URL}/wiki/rest/api/content`;\nconst SEARCH_URL = `${REST_URL}/search?cql=space=DB and `;\n\nconst HOME_PAGE_TITLE = 'Home';\nconst LINKS_PLACEHOLDER = `(Topic links will automatically appear here.)`;\n\n// Replace links to label pages with equivalent site URLs.\nconst labelUrlRegex = new RegExp(`${BASE_URL}/wiki/label/DB/([^\"]+)`);\n\n// Replace links to regular pages with equivalent site URLs.\nconst pageUrlRegex = /\\/wiki\\/display\\/DB\\/([^\"]+)/;\n\n// Replace links to viewpage.action URLs.\n// Confluence uses such links if a page's title contains odd characters.\nconst viewpageUrlRegex = /\\/wiki\\/pages\\/viewpage\\.action\\?pageId=(\\d+)/;\n\n\n// Map certain wiki page titles -> site URLs by hand.\nconst mapPageTitleToSiteUrl = {\n  'About': '/About',\n  'Development+volunteers': '/Volunteering/Development+volunteers',\n  'Home': '/',\n  'Submissions': '/Submissions',\n  'Volunteering': '/Volunteering',\n  'Code+of+Conduct': '/Volunteering/Code+of+Conduct'\n};\n\n\n/*\n * Format a page title for use in a wiki URL.\n */\nfunction escapePageTitle(title) {\n  return title.replace(/ /g, '+');\n}\n\n/*\n * Return a promise for the title for the page with the given ID.\n */\nfunction getTitleForPageWithId(pageId) {\n  const query = `${REST_URL}/${pageId}`;\n  return fetch(query)\n  .then(response => response.json())\n  .then(json => {\n    const title = escapePageTitle(json.title);\n    return title;\n  });\n}\n\n/*\n * Return the site URL for the label page for the given label.\n */\nfunction labelToSiteUrl(label) {\n  // Use hand-mapped URL if it exists.\n  return `/reference/label/${label}`;\n}\n\n/*\n * Return the site URL for the regular page with the given title.\n */\nfunction pageTitleToSiteUrl(title) {\n  // Use hand-mapped URL if it exists.\n  // All other pages are presented in the \"/reference\" area of the site.\n  const escaped = escapePageTitle(title);\n  return mapPageTitleToSiteUrl[escaped] || `/reference/${escaped}`;\n}\n\nfunction replacePlaceholderWithLinks(html, linksHtml) {\n  const placeholder = `<em>${LINKS_PLACEHOLDER}</em>`;\n  return html.replace(placeholder, linksHtml);\n}\n\n/*\n * Rewrite the indicated attribute of the given element if necessary.\n */\nfunction rewriteElementAttribute($element, attributeName) {\n\n  const attributeValue = $element.attr(attributeName);\n\n  const labelUrlMatch = labelUrlRegex.exec(attributeValue);\n  if (labelUrlMatch) {\n    const label = labelUrlMatch[1];\n    const rewritten = labelToSiteUrl(label);\n    $element.attr(attributeName, rewritten);\n    return; // No more processing necessary.\n  }\n\n  const pageUrlMatch = pageUrlRegex.exec(attributeValue);\n  if (pageUrlMatch) {\n    const title = pageUrlMatch[1];\n    const rewritten = pageTitleToSiteUrl(title);\n    $element.attr(attributeName, rewritten);\n    return;\n  }\n\n  const viewpageUrlMatch = viewpageUrlRegex.exec(attributeValue);\n  if (viewpageUrlMatch) {\n    const pageId = viewpageUrlMatch[1];\n    const rewritten = `/reference/id/${pageId}`;\n    $element.attr(attributeName, rewritten);\n  }\n}\n\n// Rewrite HTML for public consumption.\nfunction rewriteHtml(html) {\n  const $ = cheerio.load(html); // Parse HTML\n\n  // Rewrite wiki-relative links in `href` attributes.\n  $('a[href]').each((index, element) => {\n    rewriteElementAttribute($(element), 'href');\n  });\n\n  // Remove internal project notes.\n  // These are indicated as `em` (italics) nodes that begin and end with\n  // parentheses.\n  $('em').each((index, element) => {\n    const $element = $(element);\n    const text = $element.text().trim();\n    if (text === LINKS_PLACEHOLDER) {\n      // Leave links placeholder alone; it'll be handled separately.\n      return;\n    }\n    const isInternalNote = text.startsWith('(') && text.endsWith(')');\n    if (isInternalNote) {\n      $element.remove();\n    }\n  });\n\n  return $.html(); // Return rewritten HTML\n}\n\nfunction unescapePageTitle(escapedPageTitle) {\n  return escapedPageTitle.replace(/\\+/g, ' ');\n}\n\n// Return a promise for the wiki page with the given title.\n// The result is a JSON structured returned by Confluence. Wiki-relative paths\n// in the result will be modified to refer to URLs on our site instead.\nfunction wikiPageWithTitle(title) {\n  const query = `${REST_URL}?spaceKey=DB&title=${title}&expand=space,ancestors,body.view`;\n  console.log(`Page: ${query}`);\n  return fetch(query)\n  .then(response => response.json())\n  .then(json => {\n\n    // Usually we get a single result, but under some conditions (can't recall\n    // which) it's an array.\n    const pageJson = json.results instanceof Array ?\n      json.results[0] :\n      json;\n\n    if (!pageJson) {\n      return null;\n    }\n\n    const ancestors = pageJson.ancestors;\n    const title = pageJson.title;\n    const wikiBody = pageJson.body.view.value;\n\n    // The body will include link which are relative to the wiki.\n    // We fix those up so they refer to URLs on our site instead.\n    const body = rewriteHtml(wikiBody);\n\n    return { ancestors, body, title };\n  });\n}\n\n\nmodule.exports = {\n  BASE_URL,\n  escapePageTitle,\n  getTitleForPageWithId,\n  HOME_PAGE_TITLE,\n  labelToSiteUrl,\n  pageTitleToSiteUrl,\n  replacePlaceholderWithLinks,\n  REST_URL,\n  rewriteHtml,\n  SEARCH_URL,\n  unescapePageTitle,\n  wikiPageWithTitle\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/connectors/wiki.js","const cheerio = require('cheerio');\nconst fetch = require('node-fetch');\nconst wiki = require('../connectors/wiki');\n\n\n// Time in milliseconds we should cache the navigation.\nconst NAVIGATION_CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\n// The Date.now() timestamp of our last request for the navgation.\nlet navigationTimestamp = 0;\n\n// The cached navigation HTML.\nlet cachedNavigationHtml;\n\n\n/*\n * Return a promise for the HTML that should be used in the navigation pane.\n *\n * The content for the pane is maintained on a special page on the wiki with\n * the title \"Navigation\". That page isn't directly accessible through the\n * site navigation, and is only used here to construct the navigation UI.\n *\n * Because the navigation outline doesn't change often, we cache the result for\n * a period before asking for it again. The same navigation pane is shared\n * across all pages that use the pane.\n */\nmodule.exports = () => {\n  const needsRefresh = cachedNavigationHtml == null ||\n      (Date.now() - navigationTimestamp) > NAVIGATION_CACHE_DURATION;\n  if (needsRefresh) {\n    // Get navigation from server.\n    return getNavigationFromWiki()\n    .then(html => {\n      cachedNavigationHtml = html;\n      return html;\n    });\n  } else {\n    // Return cached result.\n    return Promise.resolve(cachedNavigationHtml);\n  }\n};\n\n\n// Returns a promise to get the navigation HTML from the wiki.\nfunction getNavigationFromWiki() {\n  const title = 'Navigation';\n  const query = `${wiki.REST_URL}?spaceKey=DB&title=${title}&expand=body.view`;\n  console.log(`Navigation: ${query}`);\n  return fetch(query)\n  .then(response => response.json())\n  .then(wikiResults => {\n    navigationTimestamp = Date.now(); // Note the time we got this response.\n\n    const wikiPageJson = wikiResults.results[0];\n    const body = wikiPageJson.body.view.value;\n\n    // Map wiki-relative URLs to our own routes.\n    const rewrittenHtml = wiki.rewriteHtml(body);\n\n    // For each list item in the navigation pane, add an attribute on it that\n    // will help us reflect the user's current position in the outline using\n    // styling applied with CSS that matches that attribute. The goal of this\n    // is to avoid having to update the navigation links for individual pages.\n    const $ = cheerio.load(rewrittenHtml); // Parse HTML\n    // Find all list items.\n    $('li').each((index, li) => {\n      const $li = $(li); // Get list item.\n      const $a = $($li.children('a')[0]); // Get the anchor tag within it.\n      if ($a) {\n        // Get the anchor's text. This will be the page title.\n        const text = $a.text();\n        // Expose that text on the list item as an attribute.\n        $li.attr('navigation-item', text);\n      }\n    });\n\n    const navigationPaneHtml = $.html();\n    return navigationPaneHtml;\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/pages/navigationPane.js","import AppShell from './AppShell';\nimport routes from './routes';\n\n\n/**\n * Single export for all components.\n */\nexport { AppShell, routes };\n\n\n\n// WEBPACK FOOTER //\n// ./components/Components.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nconst wiki = require('../server/connectors/wiki');\n\n\n/**\n * Breadcrumb bar\n */\nexport default class BreadcrumbBar extends Component {\n\n  render(props) {\n\n    // TODO: Add ' / ' ::before the breadcrumbs.\n\n    // Pages without known ancestors get \"Home\" as their default ancestor.\n    const ancestors = props.ancestors || [{ title: 'Home' }];\n\n    const breadcrumbs = ancestors.map(ancestor => {\n      const title = ancestor.title;\n      const siteUrl = wiki.pageTitleToSiteUrl(title);\n      return (\n        <a href={siteUrl}>{title}</a>\n      );\n    });\n\n    return (\n      <div class=\"breadcrumbs\">{breadcrumbs}</div>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/BreadcrumbBar.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nimport DaysRemaining from './DaysRemaining';\nimport TweetButton from './TweetButton';\n\n/**\n * Standard template footer\n */\nexport default class Footer extends Component {\n\n  render(props) {\n    return (\n      <footer>\n        <p>\n          <TweetButton text={props.title} url={props.url}/>\n        </p>\n        {props.children}\n        <DaysRemaining/>\n      </footer>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/Footer.jsx","import { Component, h } from 'preact'; // jshint ignore:line\n\n\n/**\n * Show a count of the days remaining in the administration.\n */\nexport default class DaysRemaining extends Component {\n\n  render(props) {\n\n    const today = new Date(Date.now());\n    const inaugurationDate = new Date(Date.parse('Mon, Jan 20 2021 12:00:00 EST'));\n\n    // From \"a more correct solution\" for date diff math:\n    // http://stackoverflow.com/a/15289883/76472.\n    const utc1 = Date.UTC(today.getFullYear(), today.getMonth(), today.getDate());\n    const utc2 = Date.UTC(inaugurationDate.getFullYear(), inaugurationDate.getMonth(), inaugurationDate.getDate());\n    const diffMilliseconds = utc2 - utc1;\n    const MILLISECONDS_PER_DAY = 24 * 60 * 60 * 1000;\n    const diffDays = Math.floor(diffMilliseconds / MILLISECONDS_PER_DAY);\n\n    let message;\n    if (diffDays === 0) {\n      message = (\n        <strong>This is the last day of the Trump administration!</strong>\n      );\n    } else if (diffDays > 0) {\n      const days = diffDays === 1 ? 'day' : 'days';\n      message = (\n        <span>\n          There are only <strong>{diffDays}</strong> {days} to go in the Trump\n          administration.\n        </span>\n      );\n    } else {\n      // Administration is over. Whew.\n      message = '';\n    }\n\n    return (\n      <p id=\"daysRemainingMessage\">\n        {message}\n      </p>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/DaysRemaining.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nimport TwitterIcon from './TwitterIcon';\n\n\nexport default class TweetButton extends Component {\n\n  render(props) {\n    const encodedText = encodeURIComponent(props.text);\n    const encodedUrl = encodeURIComponent(props.url);\n    const href = `https://twitter.com/intent/tweet?via=presterity&text=${encodedText}&url=${encodedUrl}`;\n    return (\n      <a class=\"tweetButton\" href={href}>\n        <TwitterIcon fill=\"#fff\"/>\n        <span>Share</span>\n      </a>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/TweetButton.jsx","import { h } from 'preact'; // jshint ignore:line\n\n\n/**\n * Top navigation links\n */\nexport default (props) => {\n  const fill = props.fill || 'black';\n  return (\n    <svg viewBox=\"0 0 182.66667 150.66667\" style={`fill: ${fill};`}>\n      <g xmlns=\"http://www.w3.org/2000/svg\" id=\"g10\" transform=\"matrix(1.3333 0 0 -1.3333 0 150.67)\">\n        <g transform=\"scale(.1)\">\n          <path d=\"m1366.9 989.39c-50.27-22.309-104.33-37.387-161.05-44.18 57.89 34.723 102.34 89.679 123.28 155.15-54.18-32.15-114.18-55.47-178.09-68.04-51.13 54.49-124.02 88.55-204.68 88.55-154.89 0-280.43-125.55-280.43-280.43 0-21.988 2.457-43.398 7.258-63.91-233.08 11.68-439.72 123.36-578.04 293.01-24.141-41.4-37.969-89.567-37.969-140.97 0-97.308 49.489-183.13 124.76-233.44-45.969 1.437-89.218 14.058-127.03 35.078-0.043-1.18-0.043-2.348-0.043-3.52 0-135.9 96.68-249.22 224.96-275-23.512-6.41-48.281-9.8-73.86-9.8-18.089 0-35.628 1.711-52.781 5 35.711-111.41 139.26-192.5 262-194.77-96.058-75.23-216.96-120.04-348.36-120.04-22.621 0-44.961 1.332-66.918 3.91 124.16-79.568 271.55-125.98 429.94-125.98 515.82 0 797.86 427.31 797.86 797.93 0 12.153-0.28 24.223-0.79 36.25 54.77 39.571 102.31 88.95 139.93 145.2\"></path>\n        </g>\n      </g>\n    </svg>\n  );\n};\n\n\n\n// WEBPACK FOOTER //\n// ./components/TwitterIcon.jsx","import ErrorPage from './ErrorPage';\nimport Hello from './Hello';\nimport NotFoundPage from './NotFoundPage';\nimport WikiPage from './WikiPage';\n\n\n/**\n * Map routes to components.\n */\nexport default {\n  '/error': ErrorPage,\n  '/hello': Hello,\n  '/notfound': NotFoundPage, // TODO: Remove\n  '/:title': WikiPage,\n  '/:area/:title': WikiPage\n};\n\n\n\n// WEBPACK FOOTER //\n// ./components/routes.js","import { h } from 'preact'; // jshint ignore:line\nimport PageTemplate from './PageTemplate';\n\n\n/**\n * Error page.\n */\nexport default class ErrorPage extends PageTemplate {\n\n  render(props) {\n    return (\n      <PageTemplate\n          navigation={props.navigation}\n          title={this.title}\n          url={props.url}\n        >\n        <p>\n          Sorry, something went wrong. ðŸ˜ž\n        </p>\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    return \"Oops\";\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/ErrorPage.jsx","import { h } from 'preact'; // jshint ignore:line\nimport PageTemplate from './PageTemplate';\n\n\n/**\n * \"Not Found\" page.\n */\nexport default class NotFoundPage extends PageTemplate {\n\n  render(props) {\n    return (\n      <PageTemplate\n          ancestors={props.ancestors}\n          footer={props.footer}\n          navigation={props.navigation}\n          title={this.title}\n          url={props.url}\n        >\n        <p>\n          We don&rsquo;t have a page for &ldquo;{this.title}&rdquo; yet!\n        </p>\n        <p>\n          Would you consider <a href=\"/Volunteering\">volunteering</a> and\n          helping us make one?\n        </p>\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    // TODO: Pass in title when constructing page.\n    // return this.props.title;\n    return \"Not Found\";\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/NotFoundPage.jsx","import { h } from 'preact'; // jshint ignore:line\nimport bookmarks from '../server/connectors/bookmarks';\nimport BookmarkList from './BookmarkList';\nimport PageTemplate from './PageTemplate';\nimport render from 'preact-render-to-string';\nimport wiki from '../server/connectors/wiki';\n\n\n/**\n * A page that renders content from the Atlassian wiki.\n */\nexport default class WikiPage extends PageTemplate {\n\n  get asyncProperties() {\n\n    const title = this.title;\n\n    // Load the wiki page with the given title.\n    const pagePromise = wiki.wikiPageWithTitle(title)\n    .then(wikiPage => {\n      return {\n        ancestors: wikiPage.ancestors,\n        body: wikiPage.body\n      };\n    });\n\n    // Load the bookmarks tagged with the same title.\n    const bookmarksPromise = bookmarks.bookmarksForTopic(title)\n    .then(bookmarks => {\n      return { bookmarks };\n    });\n\n    // Merge the above with the base class' async properties.\n    return Promise.all([super.asyncProperties, pagePromise, bookmarksPromise])\n    .then(results => {\n      return Object.assign.apply({}, results);\n    });\n  }\n\n  render(props) {\n\n    // Merge the bookmark list into the wiki page body to construct the final\n    // page body.\n    const bookmarkList = (\n      <BookmarkList bookmarks={props.bookmarks} excludeTag={this.title}/>\n    );\n    const bookmarkListHtml = render(bookmarkList);\n    const body = wiki.replacePlaceholderWithLinks(props.body, bookmarkListHtml);\n\n    const footer = (\n      <div>\n        <p>\n          You can <a href=\"/Submissions\">submit news</a> on this topic.\n          If something's wrong on this\n          page, <a href=\"/Volunteering\">help us fix it</a>.\n        </p>\n        <p>\n          This work is licensed under\n          a <a rel=\"license\" href=\"https://creativecommons.org/licenses/by/4.0/\">Creative Commons Attribution 4.0 International License</a>.\n        </p>\n      </div>\n    );\n\n    return (\n      <PageTemplate\n          ancestors={props.ancestors}\n          navigation={props.navigation}\n          title={this.title}\n          url={props.url}\n          footer={footer}\n        >\n        <div dangerouslySetInnerHTML={{ __html: body }} />\n      </PageTemplate>\n    );\n  }\n\n  get title() {\n    const requestTitle = this.props.request.params.title;\n    const title = wiki.unescapePageTitle(requestTitle);\n    return title;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/WikiPage.jsx","import { Component, h } from 'preact'; // jshint ignore:line\nimport Bookmark from './Bookmark';\n\n\n/**\n * A list (actually, a table) of bookmarks whose tags include a given title.\n */\nexport default class BookmarkList extends Component {\n\n  render(props) {\n    const bookmarks = props.bookmarks.map(bookmarkProps => (\n      <Bookmark {...bookmarkProps} excludeTag={props.excludeTag}/>\n    ));\n    return (\n      <table class=\"topicLinks\">{bookmarks}</table>\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/BookmarkList.jsx","module.exports = require(\"preact-render-to-string\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"preact-render-to-string\"\n// module id = 21\n// module chunks = 0","/*\n * The site's connection to, and representation of, the Raindrop bookmark API.\n *\n * The general principle is that this module isolates anything specific to\n * Raindrop. If we were to change to a different bookmarks back-end, this module\n * would get replaced, but much of the rest of the server could stay the same.\n *\n * Raindrop bookmark results are paginated: http://raindrop.io/dev/docs#bookmarks.\n * The first page of results includes a `count` property indicating how many\n * total results there are. Once we have that, we know how many more pages of\n * results to ask for.\n *\n * To keep the client as simple as possible, we get *all* bookmarks for a given\n * topic at once. This works at a small scale, but will become slow as we gather\n * 100s of bookmarks per topic. On the plus side:\n *\n * * Since we have server-side caching, once someone visits a page, subsequent\n *   visitors within the cache interval will immediately get a complete page of\n *   results.\n *\n * * This also means that only our server is hitting Raindrop, reducing the\n *   degree to which we may annoy them.\n *\n * At some point, we'd like to have our own DB of bookmarks, and at that point\n * should add infinite-scrolling to the client so the client can request only\n * those results it actually needs to fill the page.\n */\n\n\nconst fetch = require('node-fetch');\n\nconst PRESTERITY_BOOKMARK_COLLECTION_ID = 2021037;\nconst RAINDROP_REST_URL = `https://raindrop.io/api/raindrops/${PRESTERITY_BOOKMARK_COLLECTION_ID}`;\nconst MAX_BOOKMARKS_PER_PAGE = 40; // Limit imposed by Raindrop.\n\n\n/*\n * Return a promise for the complete set of bookmarks on the given topic.\n * The topic is identified with a string: \"Trump Cabinet\".\n *\n * The bookmarks are returned sorted by bookmark title. Since we start bookmark\n * titles with a date in YYYY.MM.DD format, the bookmarks will also be sorted\n * by date.\n */\nfunction bookmarksForTopic(topic) {\n\n  let bookmarks;\n\n  // Fetch the initial results: page 0.\n  return getResultsForPage(topic, 0)\n  .then(resultPage0 => {\n\n    // Save the page 0 bookmarks.\n    bookmarks = resultPage0.items;\n\n    // The results include a `count` property that gives the total number of\n    // bookmarks. Use this to calculate how many more pages we need fetch.\n    const bookmarkCount = resultPage0.count;\n    const pageCount = Math.ceil(bookmarkCount / MAX_BOOKMARKS_PER_PAGE);\n\n    // Now get pages 1..pageCount.\n    return getResultsForPages(topic, pageCount);\n  })\n  .then(additionalResultPages => {\n\n    // Combine bookmarks from additional pages (if any) with set from page 0.\n    additionalResultPages.forEach(resultPage => {\n      bookmarks = bookmarks.concat(resultPage.items);\n    });\n\n    // Raindrop's sorting facilities are limited, so we sort ourselves.\n    const sorted = bookmarks.sort(compareBookmarks);\n\n    return sorted;\n  });\n}\n\n// Sort two bookmarks by title.\n// Since the title should start with a date like 2017.01.13, sorting by title\n// should produce a chronological sort.\nfunction compareBookmarks(bookmark1, bookmark2) {\n  if (bookmark1.title < bookmark2.title) {\n    return -1;\n  }\n  if (bookmark1.title > bookmark2.title) {\n    return 1;\n  }\n  return 0;\n}\n\n// Return a promise for the indicated page of results for the given topic.\nfunction getResultsForPage(topic, pageNumber) {\n  const escapedTopic = encodeURIComponent(topic);\n  const url = `${RAINDROP_REST_URL}?search=[{\"key\":\"tag\",\"val\":\"${escapedTopic}\"}]&perpage=${MAX_BOOKMARKS_PER_PAGE}&page=${pageNumber}`;\n  console.log(`Bookmarks: ${url}`);\n  return fetch(url)\n  .then(response => response.json());\n}\n\n// Return the latest bookmarks, up to a maximum of count (but no more than 40).\n// The default count is 10.\nfunction mostRecentBookmarks(count = 10) {\n  const url = `${RAINDROP_REST_URL}?perpage=${count}`;\n  console.log(`Latest bookmarks: ${url}`);\n  return fetch(url)\n  .then(response => response.json())\n  .then(json => json.items);\n}\n\n// Return a promise for pages 1..pageCount of bookmarks for the given topic.\n// This does *not* get the bookmarks on page 0. We handle those separately.\n// Accordingly, if pageCount is 0 or 1, this returns a resolved promise for\n// an empty array.\nfunction getResultsForPages(topic, pageCount) {\n  let promises = [];\n  for (let page = 1; page < pageCount; page++) {\n    promises = promises.concat(getResultsForPage(topic, page));\n  }\n  return Promise.all(promises);\n}\n\nmodule.exports = {\n  bookmarksForTopic,\n  mostRecentBookmarks\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/connectors/bookmarks.js","import { Component, h } from 'preact'; // jshint ignore:line\nimport wiki from '../server/connectors/wiki';\n\n\n/**\n * Return a bookmark from the server as HTML for presentation to the user.\n * This will be a row intended for display in a table.\n *\n * The result will include \"See also\" links to topics tagged on the bookmark. If\n * an \"excludeTag\" property has been supplied, a \"See also\" link will *not* be\n * included for the indicated topic (since the user will already be looking at\n * that page).\n */\nexport default class Bookmark extends Component {\n\n  render(props) {\n\n    let domain = props.domain;\n    if (domain.startsWith('www.')) {\n      domain = domain.slice(4); // Remove \"www.\"\n    }\n\n    // Our bookmark format has writers put the date of an event in the bookmark\n    // title. Parse that out.\n    const { date, text } = parseLinkTitle(props.title);\n\n    // Construct list of bookmark tags. If a current title has been supplied,\n    // *don't* include that tag. Otherwise, include all tags.\n    const tags = props.tags\n      .filter(tag => tag !== props.excludeTag)\n      .map((tag, index) => {\n        const url = `/reference/${wiki.escapePageTitle(tag)}`;\n        const comma = index > 0 ? ', ' : '';\n        return (\n          <span>\n            {comma}\n            <a href={url}>{tag}</a>\n          </span>\n        );\n      });\n\n    let seeAlsoSection = null;\n    if (tags.length > 0) {\n      const seeLabel = props.excludeTag ? 'See also' : 'See';\n      seeAlsoSection = (\n        <span>({seeLabel} {tags})</span>\n      );\n    }\n\n    // The bookmark may have an optional description (\"excerpt\").\n    const excerpt = props.excerpt ?\n      (\n        <div>\n          <div class=\"excerpt\">{props.excerpt}</div>\n        </div>\n      ) :\n      null;\n\n    return (\n      <tr>\n        <td>{date}</td>\n        <td>\n          {text}&nbsp;\n          <a href={props.link}>{domain}</a>&nbsp;\n          {seeAlsoSection}\n          {excerpt}\n        </td>\n      </tr>\n    );\n  }\n\n}\n\n\nfunction parseLinkTitle(title) {\n  // Find link parts:\n  // * optional whitespace to start\n  // * date in 2017.01.17 format, can also use hyphens\n  // * whitespace\n  // * remaining text\n  const linkPartsRegex = /^\\s*([\\d\\.-]+)\\s+(.*)/;\n  const match = linkPartsRegex.exec(title);\n  let date;\n  let text;\n  if (match) {\n    date = match[1];\n    text = match[2];\n  } else {\n    date = '';\n    text = title;\n  }\n  return { date, text };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./components/Bookmark.jsx"],"sourceRoot":""}